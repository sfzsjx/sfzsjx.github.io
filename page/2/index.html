<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
  
    <meta name="description" content="天道酬勤">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    
    上善若水博客</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body>
<main class="content">
  <section class="jumbotron">
  <div class="video">
    
      <div class="video-frame">
        <img src="/images/ocean/overlay-hero.png" alt="Decorative image frame">
      </div>
    
    <div class="video-media">
      <video playsinline="" autoplay="" loop="" muted="" data-autoplay=""
             poster="/images/ocean/ocean.png" x5-video-player-type="h5">
        <source src="/images/ocean/ocean.mp4" type="video/mp4">
        <source src="/images/ocean/ocean.ogv" type="video/ogg">
        <source src="/images/ocean/ocean.webm" type="video/webm">
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="video-inner text-center text-white">
      <h1><a href="/">上善若水博客</a></h1>
      <p>大数据</p>
      <div><img src="/images/hexo-inverted.svg" class="brand" alt="上善若水博客"></div>
    </div>
    <div class="video-learn-more">
      <a class="anchor" href="#landingpage"><i class="fe fe-mouse"></i></a>
    </div>
  </div>
</section>

<div id="landingpage">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>

    
      
        

<article id="post-spark-standalone-运行原理" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/08/26/spark-standalone-运行原理/">spark standalone  运行原理</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/08/26/spark-standalone-运行原理/" class="article-date">
  <time datetime="2019-08-26T02:31:37.000Z" itemprop="datePublished">2019-08-26</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/spark/">spark</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <h3 id="一-、spark-standalone-运行模式"><a href="#一-、spark-standalone-运行模式" class="headerlink" title="一 、spark standalone 运行模式"></a>一 、spark standalone 运行模式</h3><p><img src="/images/2019/08/26/2f6b2e50-c7a7-11e9-b720-45f763a73cbf.png" alt="image.png"></p>
<blockquote>
<p>standalone 运行模式 是由客户端，主节点和多个worker节点组成。<br>Worker节点可以通过ExecutorRunner运行在当前节点上的CoarseGrainedExecutorBackend进程，每个Worker节点上存在一个或多个CoarseGrainedExecutorBackend进程，每个进程包含一个Executor对象。 该对象持有一个线程池,每个线程可以执行一个task。<br><code>`</code><br>1.启动应用程序，在SparkContext启动过程中，先初始化DAGScheduler 和 TaskSchedulerImpl两个调度器， 同时初始化SparkDeploySchedulerBackend，并在其内部启动DriverEndpoint 和 ClientEndpoint<br>2.ClientEndpoint向Master注册应用程序。Master收到注册消息后把应用放到待运行应用列表，使用自己的资源调度算法分配Worker资源给应用程序。<br>3.应用程序获得Worker时，Master会通知Worker中的WorkerEndpoint创建CoarseGrainedExecutorBackend进程，在该进程中创建执行容器Executor。<br>4.Executor创建完毕后发送消息到Master 和 DriverEndpoint。在SparkContext创建成功后， 等待Driver端发过来的任务。<br>5.SparkContext分配任务给CoarseGrainedExecutorBackend执行，在Executor上按照一定调度执行任务(这些任务就是自己写的代码)<br>6.CoarseGrainedExecutorBackend在处理任务的过程中把任务状态发送给SparkContext，SparkContext根据任务不同的结果进行处理。如果任务集处理完毕后，则继续发送其他任务集。<br>7.应用程序运行完成后，SparkContext会进行资源回收。</p>
</blockquote>
<pre><code>
### 二、spark standalone两种提交模式

#### 1. standalone-client 任务提交模式

提交命令：
</code></pre><h1 id="Run-on-a-Spark-standalone-cluster-in-client-deploy-mode"><a href="#Run-on-a-Spark-standalone-cluster-in-client-deploy-mode" class="headerlink" title="Run on a Spark standalone cluster in client deploy mode"></a>Run on a Spark standalone cluster in client deploy mode</h1><p>./bin/spark-submit \<br>  –class org.apache.spark.examples.SparkPi \<br>  –master spark://207.184.161.138:7077 \<br>  –executor-memory 20G \<br>  –total-executor-cores 100 \<br>  /path/to/examples.jar \<br>  1000</p>
<pre><code>例子：
</code></pre><p>#!/bin/sh<br>result_time=$(date +%Y%m%d)<br>echo “小车定位程序”</p>
<p>nohup spark-submit –class com.gree.cn.location.LocationMap –master spark://lyxbdw-02:7077 –packages org.apache.spark:spark-sql-kafka-0-10_2.11:2.4.3 –executor-memory 4G –total-executor-cores 12  /home/lyxbdw/basedata/spark/structstreaminglocation-0.0.1-SNAPSHOT-jar-with-dependencies.jar &gt; /lvm/data1/spark/log/location/${result_time}_result.log &amp;</p>
<pre><code>standalone client 模式任务流程
![image.png](/images/2019/08/26/183089c0-c7ab-11e9-b720-45f763a73cbf.png)

执行流程
1. client 模式提交任务后，会在客户端启动Driver进程。
2. Driver 会向Master申请启动Application启动资源。
3. 资源申请成功后，Driver端会将task发送到worker端执行。
4. worker端执行成功后将执行结果返回给Driver端


#### 1. standalone-cluster 任务提交模式
提交命令：
</code></pre><h1 id="Run-on-a-Spark-standalone-cluster-in-cluster-deploy-mode-with-supervise"><a href="#Run-on-a-Spark-standalone-cluster-in-cluster-deploy-mode-with-supervise" class="headerlink" title="Run on a Spark standalone cluster in cluster deploy mode with supervise"></a>Run on a Spark standalone cluster in cluster deploy mode with supervise</h1><p>./bin/spark-submit \<br>  –class org.apache.spark.examples.SparkPi \<br>  –master spark://207.184.161.138:7077 \<br>  –deploy-mode cluster \<br>  –supervise \<br>  –executor-memory 20G \<br>  –total-executor-cores 100 \<br>  /path/to/examples.jar \<br>  1000</p>
<pre><code>例子： 
</code></pre><p>#!/bin/sh<br>result_time=$(date +%Y%m%d)<br>echo “小车定位程序”</p>
<p>spark-submit –class com.gree.cn.location.LocationMap –master spark://lyxbdw-02:7077 –deploy-mode cluster –supervise  –packages org.apache.spark:spark-sql-kafka-0-10_2.11:2.4.3 –executor-memory 4G –total-executor-cores 12  /home/lyxbdw/basedata/spark/structstreaminglocation-0.0.1-SNAPSHOT-jar-with-dependencies.jar</p>
<p><code>`</code></p>
<blockquote>
<p>注意：Standalone-cluster提交方式，应用程序使用的所有jar包和文件，必须保证所有的worker节点都要有，因为此种方式，spark不会自动上传包。</p>
</blockquote>
<p>standalone-cluster模式提交任务<br><img src="/images/2019/08/26/b76b5dc0-c7ac-11e9-b720-45f763a73cbf.png" alt="image.png"></p>
<p>执行流程：</p>
<ol>
<li>客户端使用命令spark-submit –deploy-mode cluster 后会启动spark-submit进程</li>
<li>此进程为Driver向Master 申请资源。</li>
<li>Master会随机在一台Worker节点来启动Driver进程。</li>
<li>Driver启动成功后，spark-submit关闭，然后Driver向Master申请资源。</li>
<li>Master接收到请求后，会在资源充足的Worker节点上启动Executor进程。</li>
<li>Driver分发Task到Executor中执行。</li>
</ol>
<p>建议：<strong>在平时调试时使用client模式，在正式生产环境时建议使用cluster模式</strong></p>
<p>参考文章：<a href="https://www.cnblogs.com/wangtcc/p/da-huaSpark-5san-tu-xiang-shuSpark-StandaloneClien.html" target="_blank" rel="noopener">1、大话Spark(5)-三图详述Spark Standalone/Client/Cluster运行模式</a><br><a href="https://blog.csdn.net/qq_39131779/article/details/83539608" target="_blank" rel="noopener">2、Spark中Standalone的两种提交模式（Standalone-client模式与Standalone-cluster模式）</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/26/spark-standalone-运行原理/" data-id="ck3o5xx7s002r8wujys52bvyz"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spark/">Spark</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-redis-数据库" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/08/22/redis-数据库/">redis 数据库</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/08/22/redis-数据库/" class="article-date">
  <time datetime="2019-08-22T11:00:10.000Z" itemprop="datePublished">2019-08-22</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据库/">数据库 </a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <p><strong>Redis 数据库</strong></p>
<blockquote>
<p>Redis是一个开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。<br>它通常被称为数据结构服务器，因为值（value）可以是 字符串(String), 哈希(Hash), 列表(list), 集合(sets) 和 有序集合(sorted sets)等类型。</p>
</blockquote>
<p>Redis 安装参考<a href="https://www.runoob.com/redis/redis-install.html" target="_blank" rel="noopener">redis基础教程</a></p>
<h3 id="一、客户端模式："><a href="#一、客户端模式：" class="headerlink" title="一、客户端模式："></a>一、客户端模式：</h3><pre><code>cd /usr/local/redis/redis-5.0.5/src
./redis-cli --raw
hvals materialinfo
</code></pre><h3 id="二、springboot-与-redis-整合"><a href="#二、springboot-与-redis-整合" class="headerlink" title="二、springboot 与 redis 整合"></a>二、springboot 与 redis 整合</h3><p>1.引入依赖</p>
<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
  &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;
&lt;/dependency&gt;

</code></pre><p>2.配置依赖文件</p>
<pre><code># redisspring.redis.host = 172.80.122.33
spring.redis.port = 6379
spring.redis.database = 0
spring.redis.timeout = 100ms
spring.redis.lettuce.pool.max-active = 8
spring.redis.lettuce.pool.max-idle = 8
spring.redis.lettuce.pool.min-idle = 0
spring.redis.lettuce.pool.max-wait = 100ms

</code></pre><p>3.使用redisTemplate</p>
<pre><code>  @Autowired 
  private RedisTemplate&lt;String,String&gt; redisTemplate;

  redisTemplate.opsForHash().entries(&quot;scada:dashboard:enamelling_line_status&quot;);

</code></pre><h3 id="redis-client操作redis数据"><a href="#redis-client操作redis数据" class="headerlink" title="redis-client操作redis数据"></a>redis-client操作redis数据</h3><p>1.引入依赖</p>
<pre><code> &lt;!-- Redis客户端 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;redis.clients&lt;/groupId&gt;
            &lt;artifactId&gt;jedis&lt;/artifactId&gt;
            &lt;version&gt;2.7.1&lt;/version&gt;
        &lt;/dependency&gt;

</code></pre><p>2.配置数据库连接池</p>
<pre><code>private static JedisPool jedisPool;
    private Jedis jedis;
    static {
        JedisPoolConfig config = new JedisPoolConfig();
        config.setMaxTotal(20);
        config.setMaxIdle(5);
        config.setMaxWaitMillis(1000);
        config.setMinIdle(2);
        config.setTestOnBorrow(false);
        jedisPool = new JedisPool(config, &quot;127.0.0.1&quot;, 6379);
    }
    private static synchronized Jedis getJedis(){
        return jedisPool.getResource();
    }

</code></pre><p>3.操作数据库</p>
<pre><code> jedis = getJedis();
 jedis.hvals(&quot;materialinfo&quot;);

</code></pre><h3 id="redis-client-命令操作"><a href="#redis-client-命令操作" class="headerlink" title="redis client 命令操作"></a>redis client 命令操作</h3><pre><code>对String操作命令
</code></pre><ul>
<li>set(Key,value) :给数据库中名称为Key的String赋值value</li>
<li>get(Key):返回数据库中名称为Key的String的value</li>
<li>getset(key, value)：给名称为 key 的 string 赋予上一次的 value</li>
<li>mget(key1, key2,…, key N)：返回库中多个 string 的 value</li>
<li>setnx(key, value)：添加 string，名称为 key，值为 value</li>
<li>setex(key, time, value)：向库中添加 string，设定过期时间 time</li>
<li>mset(key N, value N)：批量设置多个 string 的值</li>
<li>msetnx(key N, value N)：如果所有名称为 key i 的 string 都不存在</li>
<li>incr(key)：名称为 key 的 string 增 1 操作</li>
<li>incrby(key, integer)：名称为 key 的 string 增加 integer</li>
<li>decr(key)：名称为 key 的 string 减 1 操作</li>
<li>decrby(key, integer)：名称为 key 的 string 减少 integer</li>
<li>append(key, value)：名称为 key 的 string 的值附加 value</li>
<li>substr(key, start, end)：返回名称为 key 的 string 的 value 的子串</li>
</ul>
<pre><code>对List操作命令
</code></pre><ul>
<li>rpush(key, value)：在名称为 key 的 list 尾添加一个值为 value 的元素</li>
<li>lpush(key, value)：在名称为 key 的 list 头添加一个值为 value 的元素</li>
<li>llen(key)：返回名称为 key 的 list 的长度</li>
<li>lrange(key, start, end)：返回名称为 key 的 list 中 start 至 end 之间的元素</li>
<li>ltrim(key, start, end)：截取名称为 key 的 list</li>
<li>lindex(key, index)：返回名称为 key 的 list 中 index 位置的元素</li>
<li>lset(key, index, value)：给名称为 key 的 list 中 index 位置的元素赋值</li>
<li>lrem(key, count, value)：删除 count 个 key 的 list 中值为 value 的元素</li>
<li>lpop(key)：返回并删除名称为 key 的 list 中的首元素</li>
<li>rpop(key)：返回并删除名称为 key 的 list 中的尾元素</li>
<li>blpop(key1, key2,… key N, timeout)：lpop 命令的 block 版本。</li>
<li>brpop(key1, key2,… key N, timeout)：rpop 的 block 版本。</li>
<li><p>rpoplpush(srckey, dstkey)：返回并删除名称为 srckey 的 list 的尾元素，并将该元素添加到名称为 dstkey 的 list 的头部</p>
<p>  对Set操作命令    </p>
</li>
<li>sadd(key, member)：向名称为 key 的 set 中添加元素 member</li>
<li>srem(key, member) ：删除名称为 key 的 set 中的元素 member</li>
<li>spop(key) ：随机返回并删除名称为 key 的 set 中一个元素</li>
<li>smove(srckey, dstkey, member) ：移到集合元素</li>
<li>scard(key) ：返回名称为 key 的 set 的基数</li>
<li>sismember(key, member) ：member 是否是名称为 key 的 set 的元素</li>
<li>sinter(key1, key2,…key N) ：求交集</li>
<li>sinterstore(dstkey, (keys)) ：求交集并将交集保存到 dstkey 的集合</li>
<li>sunion(key1, (keys)) ：求并集</li>
<li>sunionstore(dstkey, (keys)) ：求并集并将并集保存到 dstkey 的集合</li>
<li>sdiff(key1, (keys)) ：求差集</li>
<li>sdiffstore(dstkey, (keys)) ：求差集并将差集保存到 dstkey 的集合</li>
<li>smembers(key) ：返回名称为 key 的 set 的所有元素</li>
<li><p>srandmember(key) ：随机返回名称为 key 的 set 的一个元素</p>
<p>  对 Hash 操作的命令</p>
</li>
<li>hset(key, field, value)：向名称为 key 的 hash 中添加元素 field</li>
<li>hget(key, field)：返回名称为 key 的 hash 中 field 对应的 value</li>
<li>hmget(key, (fields))：返回名称为 key 的 hash 中 field i 对应的 value</li>
<li>hmset(key, (fields))：向名称为 key 的 hash 中添加元素 field</li>
<li>hincrby(key, field, integer)：将名称为 key 的 hash 中 field 的 value 增加 integer</li>
<li>hexists(key, field)：名称为 key 的 hash 中是否存在键为 field 的域</li>
<li>hdel(key, field)：删除名称为 key 的 hash 中键为 field 的域</li>
<li>hlen(key)：返回名称为 key 的 hash 中元素个数</li>
<li>hkeys(key)：返回名称为 key 的 hash 中所有键</li>
<li>hvals(key)：返回名称为 key 的 hash 中所有键对应的 value</li>
<li>hgetall(key)：返回名称为 key 的 hash 中所有的键（field）及其对应的 value</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/22/redis-数据库/" data-id="ck3o5xx7r002o8wujxub24doy"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-Intellij-IDEA-问题记录" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/08/15/Intellij-IDEA-问题记录/">Intellij IDEA 问题记录</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/08/15/Intellij-IDEA-问题记录/" class="article-date">
  <time datetime="2019-08-15T08:03:58.000Z" itemprop="datePublished">2019-08-15</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/IDEA/">IDEA</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <p>Intellij IDEA 问题记录 </p>
<p>问题一、</p>
<pre><code>Intellij idea Language level和Java Compiler版本自动变化问题
该问题主要是由于刷新pom.xml文件时，IDEA的这两个参数就会恢复成默认值
解决办法：
在pom.xml中加入以下配置

&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.5.1&lt;/version&gt;
            &lt;configuration&gt;
                &lt;source&gt;1.8&lt;/source&gt;
                &lt;target&gt;1.8&lt;/target&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;

</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/15/Intellij-IDEA-问题记录/" data-id="ck3o5xx65000j8wujb4kqrpfc"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDEA/">IDEA</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-mysql-8-0以后授权" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/08/14/mysql-8-0以后授权/">mysql 8.0以后授权</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/08/14/mysql-8-0以后授权/" class="article-date">
  <time datetime="2019-08-14T08:25:52.000Z" itemprop="datePublished">2019-08-14</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql，数据库/">mysql，数据库</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <p>mysql 授权操作</p>
<pre><code>首先创建一个用户
create user &#39;root&#39;@&#39;172.16.247.129&#39; identified by &#39;lyxbdw&#39;;

然后进行授权
 grant all privileges on *.* to &#39;root&#39;@&#39;172.16.247.129&#39;
    -&gt; ;

刷新权限
flush privileges;


开启管理员权限，重启mysql
![image.png](/images/2019/08/14/6a9ca990-be6f-11e9-8d50-b3f800759cdf.png)

</code></pre><p><img src="/images/2019/08/14/74cdc340-be6f-11e9-8d50-b3f800759cdf.png" alt="image.png"></p>
<p>查看某个用户权限</p>
<pre><code>show grants for  &#39;root&#39;@&#39;172.16.247.129&#39;;

</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/14/mysql-8-0以后授权/" data-id="ck3o5xx7700268wujmesojz1x"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-Spark-Windows10-安装部署" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/08/12/Spark-Windows10-安装部署/">Spark Windows10 安装部署</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/08/12/Spark-Windows10-安装部署/" class="article-date">
  <time datetime="2019-08-12T01:18:10.000Z" itemprop="datePublished">2019-08-12</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/spark/">spark</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <p>Spark centos 安装部署 </p>
<h2 id="一、Scala-安装"><a href="#一、Scala-安装" class="headerlink" title="一、Scala 安装"></a>一、Scala 安装</h2><blockquote>
<p>jdk安装不用多说，一般没什么问题，下载Scala安装包，<a href="https://www.scala-lang.org/download/all.html" target="_blank" rel="noopener">Scala安装包下载链接</a>，选择自己安装的版本。</p>
<pre><code>cd /usr/local
mkdir scala
tar -zxvf scala-2.11.8.tgz
</code></pre><p>解压安装后配置环境变量<br><code>`</code><br>vim /etc/profile</p>
</blockquote>
<p> export JAVA_HOME=/usr/local/java/jdk1.8.0_11<br> export SCALA_HOME=/usr/local/scala/scala-2.11.8<br> export SPARK_HOME=/usr/local/spark/spark-2.4.3-bin-hadoop2.7<br> export JRE_HOME=${JAVA_HOME}/jre<br> export CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib:${SCALA_HOME}/lib:${SPARK_HOME}/lib<br> export PATH=${JAVA_HOME}/bin:$PATH:${SCALA_HOME}/bin:$PATH:${SPARK_HOME}/bin<br> export SPARK_SSH_OPTS=”-p 2122”</p>
<pre><code>&gt; 主要是配置SCALA_HOME参数，然后运行source /etc/profile,并执行scala
![image.png](/images/2019/08/21/5e145a30-c3e5-11e9-b19d-dbb0f4ee7101.png)

## 二、Spark安装
&gt; Spark安装也没什么技术含量，直接下载spark安装包，[spark下载链接](https://archive.apache.org/dist/spark/spark-2.4.3/)，选择自己安装版本。
</code></pre><p>cd /usr/local<br>mkdir spark<br>cd spark<br>tar -zxvf spark-2.4.3-bin-hadoop2.7.tgz</p>
<pre><code>&gt; 同样解压后配置环境变量，主要是SPARK_HOME配置，再次执行source /etc/profile,并执行spark-shell.
![image.png](/images/2019/08/21/c1fd7b20-c3e6-11e9-b19d-dbb0f4ee7101.png)

## 三、spark standalone模式部署
&gt;进入到配置目录
</code></pre><p>cd /usr/local/spark/spark-2.4.3-bin-hadoop2.7/conf<br>mv slaves.template slaves<br>mv spark-env.sh.template spark-env.sh<br>vim spark-env.sh<br>添加以下配置</p>
<h1 id="spark-env-sh"><a href="#spark-env-sh" class="headerlink" title="spark-env.sh"></a>spark-env.sh</h1><p>export SCALA_HOME=/usr/local/scala/scala-2.11.8<br>export JAVA_HOME=/usr/local/java/jdk1.8.0_11</p>
<h1 id="本地安装绑定"><a href="#本地安装绑定" class="headerlink" title="本地安装绑定"></a>本地安装绑定</h1><p>export SPARK_MASTER_IP=127.0.0.1</p>
<p>#export SPARK_LOCAL_IP=127.0.0.1<br>export SPARK_MASTER_PORT=7077<br>export SPARK_WORKER_MEMORY=8G<br>export SPARK_EXECUTOR_CORES=4<br>export SPARK_LOG_DIR=/lvm/data1/spark/log</p>
<p>#export master=spark://10.7.20.191:7077</p>
<pre><code>&gt; 然后进入sbin目录,启动集群
</code></pre><p>cd /usr/local/spark/spark-2.4.3-bin-hadoop2.7/sbin<br>./start-all.sh</p>
<pre><code>&gt;注意若是服务器之间的免密登录端口不是22端口，则需要在 /etc/profile文件添加配置，改到对应端口
</code></pre><p>export SPARK_SSH_OPTS=”-p 2122”</p>
<pre><code>至此spark安装完成。

## Spark命令提交程序
</code></pre><p>nohup spark-submit –class com.gree.cn.location.LocationMap –master spark://lyxbdw-02:7077 –packages org.apache.spark:spark-sql-kafka-0-10_2.11:2.4.3 /home/lyxbdw/basedata/spark/structstreaminglocation-0.0.1-SNAPSHOT-jar-with-dependencies.jar &gt; /lvm/data1/spark/log/location.log &amp;</p>
<pre><code>执行脚本
</code></pre><p>#!/bin/sh<br>result_time=$(date +%Y%m%d)<br>echo “小车定位程序”<br>nohup spark-submit –class com.gree.cn.location.LocationMap –master spark://lyxbdw-02:7077 –packages org.apache.spark:spark-sql-kafka-0-10_2.11:2.4.3 /home/lyxbdw/basedata/spark/structstreaminglocation-0.0.1-SNAPSHOT-jar-with-dependencies.jar &gt; /lvm/data1/spark/log/location/${result_time}_result.log &amp;<br><code>`</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/12/Spark-Windows10-安装部署/" data-id="ck3o5xx6o00198wujcwzhdzub"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spark/">Spark</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-spark-常用参数设置" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/08/09/spark-常用参数设置/">spark 常用参数设置</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/08/09/spark-常用参数设置/" class="article-date">
  <time datetime="2019-08-09T08:50:32.000Z" itemprop="datePublished">2019-08-09</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/spark/">spark</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <pre><code>// task数量设置
spark.sql.shuffle.partitions 50
//并行度设置
spark.default.parallelism 10

</code></pre><h4 id="spark提交部署程序脚本"><a href="#spark提交部署程序脚本" class="headerlink" title="spark提交部署程序脚本"></a>spark提交部署程序脚本</h4><pre><code>#!/bin/sh
result_time=$(date +%Y%m%d)
echo &quot;小车定位程序&quot;

spark-submit --class com.gree.cn.location.LocationMap --master spark://lyxbdw-02:7077 --deploy-mode cluster --supervise  --packages org.apache.spark:spark-sql-kafka-0-10_2.11:2.4.3 --executor-memory 4G --total-executor-cores 12  /home/lyxbdw/basedata/spark/structstreaminglocation-0.0.1-SNAPSHOT-jar-with-dependencies.jar

</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/09/spark-常用参数设置/" data-id="ck3o5xx8000338wujzk7yqdfa"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spark/">spark</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-spark-sql-java-自定义函数" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/07/18/spark-sql-java-自定义函数/">spark sql  java 自定义函数</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/07/18/spark-sql-java-自定义函数/" class="article-date">
  <time datetime="2019-07-18T08:22:27.000Z" itemprop="datePublished">2019-07-18</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/spark/">spark</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <pre><code>    ::: hljs-center
</code></pre><p>java自定义函数</p>
<p>:::</p>
<p>//自定义函数将信号强度转距离<br>        //其中udf+数字中数字代表入参个数，最后一个参数代表出参的数据类型<br>        //出现序列化问题</p>
<pre><code>  ```  
</code></pre><p>spark.udf().register(“transsinglepower”, new UDF1&lt;Integer,Double&gt;() {<br>            @Override<br>            public Double call(Integer single_poer) throws Exception {<br>                Double mesure_distinct = Math.pow(10, (Math.abs(single_poer) - 59) / (10 * 2.0));<br>                return mesure_distinct;<br>            }}, DataTypes.DoubleType);</p>
<p><code>`</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/18/spark-sql-java-自定义函数/" data-id="ck3o5xx7v002u8wujz9h4fvrs"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spark/">spark</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-spring-boot-注解" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/07/16/spring-boot-注解/">spring boot 注解</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/07/16/spring-boot-注解/" class="article-date">
  <time datetime="2019-07-16T09:05:47.000Z" itemprop="datePublished">2019-07-16</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/spring-boot/">spring boot</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <p>问题一、</p>
<p>Could not autowire. No beans of ‘RestTemplate’ type found</p>
<p>在mapper 类添加注解@Repository 即可解决，简单有效</p>
<p>方法2：在mapper文件上加@Component注解，把普通pojo实例化到spring容器中</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/16/spring-boot-注解/" data-id="ck3o5xx8200368wujpxpgr9fr"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/springboot/">springboot</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-Scala-安装问题" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/07/10/Scala-安装问题/">Scala 安装问题</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/07/10/Scala-安装问题/" class="article-date">
  <time datetime="2019-07-10T05:09:01.000Z" itemprop="datePublished">2019-07-10</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Scala/">Scala</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <p>1、此时不应有 \scala\bin。<br>由于Scala 安装路径中包含空格，需要重新安装。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/10/Scala-安装问题/" data-id="ck3o5xx6n00178wuj95ny6ta7"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Scala/">Scala</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-日志切割脚本" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/07/02/日志切割脚本/">日志切割脚本</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/07/02/日志切割脚本/" class="article-date">
  <time datetime="2019-07-02T01:18:44.000Z" itemprop="datePublished">2019-07-02</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/shell/">shell</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <pre><code>#!/bin/sh
log_dir=&#39;/home/lyxbdw/basedata/server/split&#39;
monitor_file=$1
echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;` &#39;初始化切割日志文件为：&#39; $monitor_file &gt;&gt; /home/lyxbdw/basedata/server/split/split.log
if [ ! $1 ]
then
    echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;输入参数为空，使用默认路径：/home/lyxbdw/basedata/server/basedata.log&#39; &gt;&gt; /home/lyxbdw/basedata/server/split/split.log
    monitor_file=/home/lyxbdw/basedata/server/basedata.log #文件的绝对路径
fi
log_name=`basename $monitor_file`
echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;切割文件名称为：&#39;$log_name   &gt;&gt; /home/lyxbdw/basedata/server/split/split.log
file_size=`du $monitor_file | awk &#39;{print $1}&#39;`
echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;切割文件大小为：&#39;$file_size   &gt;&gt; /home/lyxbdw/basedata/server/split/split.log
if [ $file_size -ge 1024000 ]
then
    echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;文件大小大于 1024000 开始切割&#39;   &gt;&gt; /home/lyxbdw/basedata/server/split/split.log
    if [ ! -d $log_dir ]
    then
        echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;日志切割路径不存在，新建....&#39;  &gt;&gt; /home/lyxbdw/basedata/server/split/split.log
        mkdir /home/lyxbdw/basedata/server/split  #创建保存切割文件目录,这个路径可以自行修改，保存到你想要的目录
    fi
    echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;开始切割日志....&#39;  &gt;&gt; /home/lyxbdw/basedata/server/split/split.log
    echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;开始切割日志....&#39;
    cp  $monitor_file  /home/lyxbdw/basedata/server/$log_name-`date +%Y%m%d%H%M%S`.log #保存日志文件
    echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;日志切割完成。&#39;   &gt;&gt; /home/lyxbdw/basedata/server/split/split.log
    echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;日志切割完成。&#39;
    echo `date &#39;+%Y-%m-%d-%H:%M:%S&#39;`&#39;文件切割&#39; &gt;&gt; /home/lyxbdw/basedata/server/split/split.log #记录切割日志
    echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;开始清空源文件...&#39; &gt;&gt; /home/lyxbdw/basedata/server/split/split.log
    echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;开始清空源文件...&#39;
    echo &quot;&quot; &gt; $monitor_file  #清空tomcat的log/catalina.out文件内容
    echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;清空源文件完成。&#39;  &gt;&gt; /home/lyxbdw/basedata/server/split/split.log
    echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;清空源文件完成。&#39;
fi


</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/02/日志切割脚本/" data-id="ck3o5xx8p00488wujn7cnmwk6"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-Dataframe-常见问题记录" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/06/17/Dataframe-常见问题记录/">Dataframe 常见问题记录</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/06/17/Dataframe-常见问题记录/" class="article-date">
  <time datetime="2019-06-17T08:26:48.000Z" itemprop="datePublished">2019-06-17</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/DataFrame/">DataFrame</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <h3 id="问题1、不能够解析某个字段"><a href="#问题1、不能够解析某个字段" class="headerlink" title="问题1、不能够解析某个字段"></a>问题1、不能够解析某个字段</h3><blockquote>
<p>解决办法：<br>查看表名是否正确，数据库是否正确，是否存在数据库切换的情况。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/17/Dataframe-常见问题记录/" data-id="ck3o5xx5u00098wuj3ey7bqcs"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Dataframe/">Dataframe</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        

<article id="post-mybatis" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2019/06/17/mybatis/">mybatis</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/06/17/mybatis/" class="article-date">
  <time datetime="2019-06-17T02:36:51.000Z" itemprop="datePublished">2019-06-17</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据库/">数据库 </a> / <a class="article-category-link" href="/categories/数据库/mybatis/">mybatis</a>
  </div>

      </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <h2 id="1、什么是mybatis"><a href="#1、什么是mybatis" class="headerlink" title="1、什么是mybatis"></a>1、什么是mybatis</h2><blockquote>
<p>MyBatis 是一款优秀的持久层框架，它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生类型、接口和 Java 的 POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</p>
</blockquote>
<h2 id="2、Exception-in-thread-“main”-tk-mybatis-mapper-MapperException-无法获取实体类com-gree-cn-sparkstreamingkafka-entity-BasestationInfo对应的表名"><a href="#2、Exception-in-thread-“main”-tk-mybatis-mapper-MapperException-无法获取实体类com-gree-cn-sparkstreamingkafka-entity-BasestationInfo对应的表名" class="headerlink" title="2、Exception in thread “main” tk.mybatis.mapper.MapperException: 无法获取实体类com.gree.cn.sparkstreamingkafka.entity.BasestationInfo对应的表名"></a>2、Exception in thread “main” tk.mybatis.mapper.MapperException: 无法获取实体类com.gree.cn.sparkstreamingkafka.entity.BasestationInfo对应的表名</h2><p>导包选择：<br>import tk.mybatis.spring.annotation.MapperScan;</p>
<h2 id="3-tk-mybatis与springboot结合使用案例"><a href="#3-tk-mybatis与springboot结合使用案例" class="headerlink" title="3.tk.mybatis与springboot结合使用案例"></a>3.tk.mybatis与springboot结合使用案例</h2><p>（1）引入依赖</p>
<pre><code> &lt;!-- 数据库连接--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.1.10&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.0.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- 数据库连接 end --&gt;

</code></pre><p>可以看出tk.mybatis常常结合druid德鲁伊使用</p>
<p>（2）引入插件</p>
<pre><code> &lt;plugin&gt;
                &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;
                &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.3.5&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;configurationFile&gt;${basedir}/src/main/resources/generator/generatorConfig.xml&lt;/configurationFile&gt;
                    &lt;overwrite&gt;true&lt;/overwrite&gt;
                    &lt;verbose&gt;true&lt;/verbose&gt;
                &lt;/configuration&gt;
                &lt;dependencies&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;mysql&lt;/groupId&gt;
                        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
                        &lt;version&gt;${mysql.version}&lt;/version&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
                        &lt;artifactId&gt;mapper&lt;/artifactId&gt;
                        &lt;version&gt;3.4.4&lt;/version&gt;
                    &lt;/dependency&gt;
                &lt;/dependencies&gt;
            &lt;/plugin&gt;

</code></pre><p>可以看见接下来需要配置${basedir}/src/main/resources/generator/<strong>generatorConfig.xml</strong>配置文件</p>
<p>（3）在下图目录下创建generatorConfig.xml配置文件，并设置相应的参数<br><img src="/images/2019/07/24/7b143a00-adc0-11e9-a2e4-21ce6d685454.png" alt="image.png"></p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE generatorConfiguration
        PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;

&lt;generatorConfiguration&gt;
    &lt;!-- 引入数据库连接配置 --&gt;
    &lt;properties resource=&quot;jdbc.properties&quot;/&gt;

    &lt;context id=&quot;Mysql&quot; targetRuntime=&quot;MyBatis3Simple&quot; defaultModelType=&quot;flat&quot;&gt;
        &lt;property name=&quot;beginningDelimiter&quot; value=&quot;`&quot;/&gt;
        &lt;property name=&quot;endingDelimiter&quot; value=&quot;`&quot;/&gt;

        &lt;!-- 配置 tk.mybatis 插件 --&gt;
        &lt;plugin type=&quot;tk.mybatis.mapper.generator.MapperPlugin&quot;&gt;
            &lt;property name=&quot;mappers&quot; value=&quot;com.gree.cn.mybatistest.mapper.MyMapper&quot;/&gt;
        &lt;/plugin&gt;

        &lt;!-- 配置数据库连接 --&gt;
        &lt;jdbcConnection
                driverClass=&quot;${jdbc.driverClass}&quot;
                connectionURL=&quot;${jdbc.connectionURL}&quot;
                userId=&quot;${jdbc.username}&quot;
                password=&quot;${jdbc.password}&quot;&gt;
        &lt;/jdbcConnection&gt;

        &lt;!-- 配置实体类存放路径 --&gt;
        &lt;javaModelGenerator targetPackage=&quot;com.gree.cn.mybatistest.entity&quot; targetProject=&quot;src/main/java&quot;/&gt;

        &lt;!-- 配置 XML 存放路径 --&gt;
        &lt;sqlMapGenerator targetPackage=&quot;mapper&quot; targetProject=&quot;src/main/resources&quot;/&gt;

        &lt;!-- 配置 DAO 存放路径 --&gt;
        &lt;javaClientGenerator
                targetPackage=&quot;com.gree.cn.mybatistest.mapper&quot;
                targetProject=&quot;src/main/java&quot;
                type=&quot;XMLMAPPER&quot;/&gt;

        &lt;!-- 配置需要指定生成的数据库和表，% 代表所有表 --&gt;
        &lt;table catalog=&quot;bluetooth_location&quot; tableName=&quot;basestation_info&quot;&gt;
            &lt;!-- mysql 配置 --&gt;
           &lt;!-- &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot;/&gt;--&gt;
        &lt;/table&gt;
        &lt;table catalog=&quot;bluetooth_location&quot; tableName=&quot;buffer_area_info&quot;&gt;
            &lt;!-- mysql 配置 --&gt;
            &lt;!-- &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot;/&gt;--&gt;
        &lt;/table&gt;
    &lt;/context&gt;
&lt;/generatorConfiguration&gt;

</code></pre><ul>
<li>可以在上面的配置文件中需要创建数据库连接jdbc.properties配置文件,如下：<br><img src="/images/2019/07/24/28a3af20-adc1-11e9-a2e4-21ce6d685454.png" alt="image.png"><br><code>`</code><h1 id="MySQL-8-x-com-mysql-cj-jdbc-Driver"><a href="#MySQL-8-x-com-mysql-cj-jdbc-Driver" class="headerlink" title="MySQL 8.x: com.mysql.cj.jdbc.Driver"></a>MySQL 8.x: com.mysql.cj.jdbc.Driver</h1>jdbc.driverClass=com.mysql.cj.jdbc.Driver<br>jdbc.connectionURL=jdbc:mysql://localhost:3306/bluetooth_location?serverTimezone=GMT&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false<br>jdbc.username=root<br>jdbc.password=lyxbdw</li>
</ul>
<pre><code>- 然后配置实体类存放路径
- 配置 XML 存放路径
- 配置 DAO 存放路径
- 配置需要指定生成的数据库和表

（4）这些配置完成后，将创建通用的父级接口MyMapper
需要注意这个文件的创建目录，注释中有解释
![image.png](/images/2019/07/24/ca4edc50-adc1-11e9-a2e4-21ce6d685454.png)
</code></pre><p>package com.gree.cn.mybatistest.tk.mybatis.mapper;</p>
<p>import tk.mybatis.mapper.common.Mapper;<br>import tk.mybatis.mapper.common.MySqlMapper;</p>
<p>/**</p>
<ul>
<li></li>
<li>自己的 Mapper</li>
<li>特别注意，该接口不能被扫描到，否则会出错</li>
<li>@param <t><br>*/<br>public interface MyMapper<t> extends Mapper<t>, MySqlMapper<t> {<br>}</t></t></t></t></li>
</ul>
<pre><code>（5）最后再在application.properties配置
实体类路径和xml配置文件路径
</code></pre><p>mybatis.mapper-locations=classpath:mapper/*.xml<br>mybatis.type-aliases-package=com.gree.cn.mybatistest.entity</p>
<pre><code>并在主程序入口添加注解@MapperScan(basePackages = &quot;com.gree.cn.mybatistest.mapper&quot;)扫描mapper包
需要注意的是引入的依赖为 **import tk.mybatis.spring.annotation.MapperScan;**

再点击下图中的mybatis-generator:generate

![image.png](/images/2019/07/24/085050a0-adc3-11e9-a2e4-21ce6d685454.png)

前期的准备工作就完成。当然在使用前有两点需要注意下
1、自动生成的mapper文件可能不会集成通用的父类mapper接口，手动引入jar包
2、生成的实体类中表名可能会有两个点，需要手动删除一个

## 4、tk.mybatis查询数据库
</code></pre><p>package com.gree.cn.mybatistest.service.impl;</p>
<p>import com.gree.cn.mybatistest.entity.BasestationInfo;<br>import com.gree.cn.mybatistest.entity.BufferAreaInfo;<br>import com.gree.cn.mybatistest.mapper.BasestationInfoMapper;<br>import com.gree.cn.mybatistest.mapper.BufferAreaInfoMapper;<br>import com.gree.cn.mybatistest.service.MybatisTest;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.stereotype.Service;<br>import tk.mybatis.mapper.entity.Example;</p>
<p>import java.util.List;<br>@Service<br>public class MybatisTestimpl implements MybatisTest {<br>    @Autowired<br>   private BufferAreaInfoMapper bufferAreaInfoMapper;<br>    @Autowired<br>    private BasestationInfoMapper basestationInfoMapper;<br>    @Override<br>    public void mybatistest() {<br>        Example example = new Example(BufferAreaInfo.class);</p>
<pre><code>    example.createCriteria().andEqualTo(&quot;stationxcoordinate&quot;, 811)
            .andEqualTo(&quot;stationycoordinate&quot;, 130);

    List&lt;BufferAreaInfo&gt; bufferAreaInfos = bufferAreaInfoMapper.selectByExample(example);

    BasestationInfo uu = basestationInfoMapper.selectByPrimaryKey(&quot;E07DEACF031C&quot;);

    System.out.println(bufferAreaInfos.size());
    System.out.println(uu.getStationid());

}
</code></pre><p>}</p>
<p><code>`</code><br>大概步骤就是注入mapper,然后使用mapper调用sql算子进行查询，其他的都类似。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/17/mybatis/" data-id="ck3o5xx7d002d8wujsj02e6sw"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库-mybatis/">数据库 mybatis</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
  </article>
  

  
    <nav class="page-nav">
      
      <a class="extend prev" rel="prev" href="/">Prev page</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next page</a>
    </nav>
  
</section>
</div>

  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2019 上善若水博客</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>

  <aside class="sidebar">
    
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="上善若水博客"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>

  <script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/ocean.js"></script>

</body>
</html>