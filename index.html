<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.7.1" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>上善若水博客</title>


    <meta name="description" content="天道酬勤">
<meta property="og:type" content="website">
<meta property="og:title" content="上善若水博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="上善若水博客">
<meta property="og:description" content="天道酬勤">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="上善若水博客">
<meta name="twitter:description" content="天道酬勤">
<meta name="twitter:image" content="http://yoursite.com/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>
<body class="is-2-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="上善若水博客" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active"
                href="/">主页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/sfzsjx">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-8-widescreen has-order-2 column-main">
    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-29T05:37:12.000Z">2020-05-29</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/大数据/">大数据</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 分钟 读完 (大约 215 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/29/flink-算子记录/">flink 算子记录</a>
            
        </h1>
        <div class="content">
            <p>1、join静态数据库<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 关联运单表,以及订单完成情况</span><br><span class="line"> * 输入 Tuple5&lt;&gt;(positionTime, imei, latitude, longitude, geoHashValue)</span><br><span class="line"> * 输出 WayBill</span><br><span class="line"> * @author hadoop</span><br><span class="line"> */</span><br><span class="line">public class JoinWaybill extends RichFlatMapFunction&lt;Tuple5&lt;Timestamp, String, Double, Double, String&gt;, WayBill&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void flatMap(Tuple5&lt;Timestamp, String, Double, Double, String&gt; value, Collector&lt;WayBill&gt; out) throws Exception &#123;</span><br><span class="line">        Connection conn;</span><br><span class="line">        Statement statement;</span><br><span class="line">        conn = DruidPoolUtils.getConnection();</span><br><span class="line">        statement = conn.createStatement();</span><br><span class="line">        ResultSet resultSet =  statement.executeQuery(&quot;SELECT waybill_no,device_id,longitude,latitude,&quot; +</span><br><span class="line">                    &quot; geo_hash,factory_time,bind_status,leave_time,distance_departure,waybill_status,finish_time FROM  t_gps_waybill where device_id = &quot; + value.f1);</span><br><span class="line"></span><br><span class="line">        while (resultSet.next())&#123;</span><br><span class="line">                WayBill wayBill = new WayBill();</span><br><span class="line">                wayBill.setWayBill(resultSet.getString(&quot;waybill_no&quot;));</span><br><span class="line">                out.collect(wayBill);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        DruidPoolUtils.close(conn,statement);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>2.sink mysql<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.flatMap(new JoinWaybill())</span><br><span class="line">      .addSink(new RichSinkFunction&lt;WayBill&gt;() &#123;</span><br><span class="line">          @Override</span><br><span class="line">          public void invoke(WayBill value, Context context) throws Exception &#123;</span><br><span class="line">              Connection conn;</span><br><span class="line">              PreparedStatement statement;</span><br><span class="line">              conn = DruidPoolUtils.getConnection();</span><br><span class="line"></span><br><span class="line">              statement = conn.prepareStatement(</span><br><span class="line">                      &quot; INSERT INTO t_gps_test (waybill_no)&quot; +</span><br><span class="line">                              &quot; values(?)&quot; );</span><br><span class="line"></span><br><span class="line">              statement.setString( 1,  value.getWayBill() );</span><br><span class="line">              statement.execute();</span><br><span class="line">              DruidPoolUtils.close(conn,statement);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;)</span><br></pre></td></tr></table></figure></p>
<p>3.window<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.window(SlidingEventTimeWindows.of(Time.minutes(1),Time.minutes(1)))</span><br><span class="line">                .process(new JoinWaybill()).print()</span><br></pre></td></tr></table></figure></p>
<p>4.flink全局变量</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//③配置参数</span><br><span class="line">        Configuration conf = new Configuration();</span><br><span class="line">        conf.setDouble(&quot;fixDistance&quot;,2000);</span><br><span class="line">        conf.setLong(&quot;fixTime&quot;,120L);</span><br><span class="line">        env.getConfig().setGlobalJobParameters(conf);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ExecutionConfig.GlobalJobParameters globalParams = getRuntimeContext().getExecutionConfig().getGlobalJobParameters();</span><br><span class="line">        Configuration globConf = (Configuration) globalParams;</span><br><span class="line">        fixDistance = globConf.getDouble(&quot;fixDistance&quot;, 2000);</span><br><span class="line">        fixTime = globConf.getLong(&quot;fixTime&quot;, 120L);</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-29T05:33:17.000Z">2020-05-29</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/数据库/">数据库 </a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 分钟 读完 (大约 194 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/29/mysql-常见问题/">mysql 常见问题</a>
            
        </h1>
        <div class="content">
            <p>1.druidpool连接池空指针异常<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Connection conn;</span><br><span class="line">       Statement statement;</span><br><span class="line">       conn = DruidPoolUtils.getConnection();</span><br><span class="line">       statement = conn.createStatement();</span><br></pre></td></tr></table></figure></p>
<p>2.Exception in thread “main” java.sql.SQLException: Can not call getNString() when field’s charset isn’t UTF-8<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wayBill.setWayBill(resultSet.getNString(&quot;waybill_no&quot;));</span><br><span class="line">          System.out.println(resultSet.getString(&quot;waybill_no&quot;));</span><br></pre></td></tr></table></figure></p>
<p>3.当数据为null时，插入数据库是，程序异常</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   statement.setInt( 1,  wayBillInfo.getBindStatus() );</span><br><span class="line">        statement.setTimestamp( 2, wayBillInfo.getLeaveTime());</span><br><span class="line">        statement.setDouble( 3, wayBillInfo.getDistanceDeparture());</span><br><span class="line">        statement.setLong( 4, wayBillInfo.getTimeDeparture());</span><br><span class="line">        statement.setInt( 5, wayBillInfo.getWayBillStatus());</span><br><span class="line">        statement.setTimestamp( 6,  wayBillInfo.getFinishTime() );</span><br><span class="line">        statement.setString( 7, wayBillInfo.getWayBillNo() );</span><br><span class="line"></span><br><span class="line">解决办法：setObject()</span><br></pre></td></tr></table></figure>
<p>4.sql防注入以及参数传递<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Connection conn = DruidPoolUtils.getConnection();</span><br><span class="line">        PreparedStatement statement = conn.prepareStatement(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">        ResultSet resultSet = statement.executeQuery(&quot;SELECT order_no,purpose_latitude,purpose_longitude ,finish_time FROM t_gps_order_list WHERE waybill_no = &apos;&quot; +wayBill.getWayBillNo() +&quot;&apos;&quot; );</span><br></pre></td></tr></table></figure></p>
<p>5.mysql差集<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.oname, a.odesc </span><br><span class="line">FROM</span><br><span class="line">  object_a a </span><br><span class="line">  LEFT JOIN object_b b </span><br><span class="line">    ON a.oname = b.oname </span><br><span class="line">    AND a.odesc = b.odesc </span><br><span class="line">WHERE b.id IS NULL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT a.oname, a.odesc FROM object_a a </span><br><span class="line">MINUS </span><br><span class="line">SELECT b.oname, b.odesc FROM object_b b</span><br></pre></td></tr></table></figure></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-27T08:15:57.000Z">2020-05-27</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/大数据/">大数据</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 分钟 读完 (大约 328 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/27/flink-常见问题/">flink 常见问题</a>
            
        </h1>
        <div class="content">
            <p>1.Exception in thread “main” org.apache.flink.api.common.functions.InvalidTypesException: The generic type parameters of ‘Collector’ are missing. In many cases lambda methods don’t provide enough information for automatic type extraction when Java generics are involved. An easy workaround is to use an (anonymous) class instead that implements the ‘org.apache.flink.streaming.api.functions.windowing.AllWindowFunction’ interface. Otherwise the type has to be specified explicitly using type information</p>
<p><img src="/images/2020/05/27/05f0a360-9ff2-11ea-ba39-730617437852.png" alt="image.png"></p>
<p>解决办法：加上返回数据类型，如：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.returns(TypeInformation.of(new TypeHint&lt;List&lt;Tuple8&lt;Timestamp, String, Double, Double, String, Integer, Long, String&gt;&gt;&gt;()&#123;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p>
<p>2.flink 一直重复计算第一条数据<br><img src="/images/2020/05/29/c3e8f080-a19a-11ea-ba39-730617437852.png" alt="image.png"></p>
<p>原因：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">与flink的状态值有关</span><br></pre></td></tr></table></figure></p>
<p>解决办法<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">每次用到value是都调用 .value方法,如：</span><br><span class="line"></span><br><span class="line"> wayBillState.value().equals(0)</span><br></pre></td></tr></table></figure></p>
<p>可能原因2：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">该算子自身报错，flinkcheckpoint 后重新计算导致程序一直在处理第一条数据</span><br></pre></td></tr></table></figure></p>
<p>3.flink的状态变量如何只更新元组中的某个字段，其他字段不更新<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">目前没有什么好办法：现提供两个不是办法的办法</span><br><span class="line">1.将两个字段分别用两个不同的状态变量保存，这样就可以分别更新了，但是造成状态变量过多，内存浪费</span><br><span class="line">2.还是用一个变量，在更新其中的某个字段时，取出不更新的字段与更新的字段和并，更新这个状态值</span><br></pre></td></tr></table></figure></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-11T07:27:49.000Z">2020-05-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/大数据/">大数据</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 读完 (大约 417 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/11/常用工具类/">常用工具类</a>
            
        </h1>
        <div class="content">
            <h3 id="时间工具类"><a href="#时间工具类" class="headerlink" title="时间工具类"></a>时间工具类</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">import java.sql.Timestamp;</span><br><span class="line">import java.text.DateFormat;</span><br><span class="line">import java.text.ParseException;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Calendar;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.Locale;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 时间工具类</span><br><span class="line"> * @author hadoop</span><br><span class="line"> * @date 2020-03-24</span><br><span class="line"> */</span><br><span class="line">public class DateUtils &#123;</span><br><span class="line"></span><br><span class="line">    private static  SimpleDateFormat standardTimeFormat = new SimpleDateFormat(&quot;yyyy-MM-dd hh:mm:ss&quot;);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 比较两个时间大小 格式yyyy-MM-dd hh:mm:ss</span><br><span class="line">     * @return 布尔值</span><br><span class="line">     */</span><br><span class="line">    public static Boolean compare2Time(Timestamp startTime, Timestamp endTime) throws ParseException &#123;</span><br><span class="line"></span><br><span class="line">        if (startTime == null || endTime == null)&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            return startTime.before(endTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 日期格式转换</span><br><span class="line">     * @param oldDateStr 原先时间格式</span><br><span class="line">     * @return 新时间格式</span><br><span class="line">     * @throws ParseException 转换</span><br><span class="line">     */</span><br><span class="line">    public static String dealDateFormat(String oldDateStr) throws ParseException&#123;</span><br><span class="line">        //此格式只有  jdk 1.7才支持  yyyy-MM-dd‘T‘HH:mm:ss.SSSXXX</span><br><span class="line">        DateFormat df = new SimpleDateFormat(&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSSXXX&quot;);</span><br><span class="line">        if (oldDateStr != null)&#123;</span><br><span class="line">            Date  date = df.parse(oldDateStr);</span><br><span class="line">            SimpleDateFormat df1 = new SimpleDateFormat (&quot;EEE MMM dd HH:mm:ss Z yyyy&quot;, Locale.UK);</span><br><span class="line">            Date date1 =  df1.parse(date.toString());</span><br><span class="line">            DateFormat df2 = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">            return df2.format(date1);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 得到两个时间差  格式yyyy-MM-dd HH:mm:ss</span><br><span class="line">     * @param start 2019-06-27 14:12:40</span><br><span class="line">     * @param end   2019-08-27 14:12:40</span><br><span class="line">     * @return 5270400000</span><br><span class="line">     */</span><br><span class="line">    public static Long dateSubtraction(String start, String end) &#123;</span><br><span class="line">        SimpleDateFormat df = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            Date date1 = df.parse(start);</span><br><span class="line">            Date date2 = df.parse(end);</span><br><span class="line">            Long diff = date2.getTime() - date1.getTime();</span><br><span class="line">            Long days = diff / (1000 * 60 * 60 * 24);</span><br><span class="line">            Long hours = (diff-days*(1000 * 60 * 60 * 24))/(1000* 60 * 60);</span><br><span class="line">            Long minutes = (diff-days*(1000 * 60 * 60 * 24)-hours*(1000* 60 * 60))/(1000* 60);</span><br><span class="line">            Long totalMin = days * 12 + hours*60 + minutes;</span><br><span class="line">            return totalMin;</span><br><span class="line">        &#125; catch (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0L;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取当前日期前一天</span><br><span class="line">     * @return 2019-08-26</span><br><span class="line">     */</span><br><span class="line">    public static String getBeforeDay() &#123;</span><br><span class="line"></span><br><span class="line">        SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span><br><span class="line">        Date date = new Date();</span><br><span class="line">        Calendar calendar = Calendar.getInstance();</span><br><span class="line">        calendar.setTime(date);</span><br><span class="line">        calendar.add(Calendar.DAY_OF_MONTH, -1);</span><br><span class="line">        date = calendar.getTime();</span><br><span class="line">        return sdf.format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取当前日期前一天新格式（yyyyMMdd）</span><br><span class="line">     * @return 2019-08-26</span><br><span class="line">     */</span><br><span class="line">    public static String getBeforeDayNewFormat() &#123;</span><br><span class="line">        SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyyMMdd&quot;);</span><br><span class="line">        Date date = new Date();</span><br><span class="line">        Calendar calendar = Calendar.getInstance();</span><br><span class="line">        calendar.setTime(date);</span><br><span class="line">        calendar.add(Calendar.DAY_OF_MONTH, -1);</span><br><span class="line">        date = calendar.getTime();</span><br><span class="line">        return sdf.format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 添加几分钟时间</span><br><span class="line">     * @param timestamp 时间戳</span><br><span class="line">     * @param time 毫秒数</span><br><span class="line">     * @return 时间戳</span><br><span class="line">     */</span><br><span class="line">    public static Timestamp addTime(Timestamp timestamp ,Long time)&#123;</span><br><span class="line"></span><br><span class="line">        return  new Timestamp(timestamp.getTime() + time);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-07T11:55:22.000Z">2020-05-07</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 读完 (大约 938 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/07/大数据处理地理数据/">大数据处理地理数据</a>
            
        </h1>
        <div class="content">
            <h2 id="1-调用http请求工具类"><a href="#1-调用http请求工具类" class="headerlink" title="1.调用http请求工具类"></a>1.调用http请求工具类</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- http start --&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;okhttp&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;4.6.0&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;!-- http end --&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">import okhttp3.*;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">public class OkHttpUtil &#123;</span><br><span class="line">    private static final Logger log = LoggerFactory.getLogger(OkHttpUtil.class);</span><br><span class="line">    public final static int CONNECT_TIMEOUT = 10;</span><br><span class="line">    public final static int READ_TIMEOUT = 30;</span><br><span class="line">    public final static int WRITE_TIMEOUT = 60;</span><br><span class="line">    private OkHttpClient mOkHttpClient;</span><br><span class="line"></span><br><span class="line">    private OkHttpUtil() &#123;</span><br><span class="line">        OkHttpClient.Builder clientBuilder = new OkHttpClient.Builder();</span><br><span class="line">        clientBuilder.readTimeout(READ_TIMEOUT, TimeUnit.SECONDS);//读取超时</span><br><span class="line">        clientBuilder.connectTimeout(CONNECT_TIMEOUT, TimeUnit.SECONDS);//连接超时</span><br><span class="line">        clientBuilder.writeTimeout(WRITE_TIMEOUT, TimeUnit.SECONDS);//写入超时</span><br><span class="line">        mOkHttpClient = clientBuilder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static OkHttpUtil getInstance() &#123;</span><br><span class="line">        return Holder.OK_HTTP_UTIL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String get(String url) throws Exception &#123;</span><br><span class="line">        return get(url, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String get(String url, HashMap&lt;String, String&gt; headers, HashMap&lt;String, String&gt; params) &#123;</span><br><span class="line">        String result = &quot;&quot;;</span><br><span class="line">        url = handleRequestParams(url, params);</span><br><span class="line"></span><br><span class="line">        Request request = new Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .headers(Headers.of(headers))</span><br><span class="line">                .get()</span><br><span class="line">                .build();</span><br><span class="line">        Call call = mOkHttpClient.newCall(request);</span><br><span class="line">        try &#123;</span><br><span class="line">            Response execute = call.execute();</span><br><span class="line">            result = execute.body().string();</span><br><span class="line"></span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            log.error(&quot;http 访问错误：&quot; + e);</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String get(String url, HashMap&lt;String, String&gt; params) throws Exception &#123;</span><br><span class="line">        String result = &quot;&quot;;</span><br><span class="line">        url = handleRequestParams(url, params);</span><br><span class="line"></span><br><span class="line">        Request request = new Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .get()</span><br><span class="line">                .build();</span><br><span class="line">        Call call = mOkHttpClient.newCall(request);</span><br><span class="line">        try &#123;</span><br><span class="line">            Response execute = call.execute();</span><br><span class="line">            int code = execute.code();</span><br><span class="line"></span><br><span class="line">            result = execute.body().string();</span><br><span class="line"></span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            log.error(&quot;http 访问错误：&quot; + e.getMessage());</span><br><span class="line">            throw new IOException(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String handleRequestParams(String url, HashMap&lt;String, String&gt; params) &#123;</span><br><span class="line">        if (params != null &amp;&amp; params.values().size() &gt; 0) &#123;</span><br><span class="line">            StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">            stringBuilder.append(&quot;?&quot;);</span><br><span class="line">            for (Map.Entry&lt;String, String&gt; entry : params.entrySet()) &#123;</span><br><span class="line">                stringBuilder.append(entry.getKey() + &quot;=&quot; + entry.getValue() + &quot;&amp;&quot;);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            String substring = stringBuilder.substring(0, stringBuilder.length() - 1);</span><br><span class="line">            url += substring;</span><br><span class="line">        &#125;</span><br><span class="line">        return url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String post(String url, HashMap&lt;String, String&gt; headerParams, String body) &#123;</span><br><span class="line">        String result = &quot;&quot;;</span><br><span class="line">        Request request = new Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .headers(Headers.of(headerParams))</span><br><span class="line">                .post(RequestBody.create(MediaType.parse(&quot;application/json&quot;), body))</span><br><span class="line">                .build();</span><br><span class="line">        Call call = mOkHttpClient.newCall(request);</span><br><span class="line">        try &#123;</span><br><span class="line">            Response execute = call.execute();</span><br><span class="line">            int code = execute.code();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.info(&quot;post请求异常&quot; + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String post(String url, String body) &#123;</span><br><span class="line">        String result = &quot;&quot;;</span><br><span class="line">        Request request = new Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .post(RequestBody.create(MediaType.parse(&quot;application/json&quot;), body))</span><br><span class="line">                .build();</span><br><span class="line">        Call call = mOkHttpClient.newCall(request);</span><br><span class="line">        try &#123;</span><br><span class="line">            Response execute = call.execute();</span><br><span class="line">            result = execute.body().string();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String xmlPost(String url, String body) &#123;</span><br><span class="line">        String result = &quot;&quot;;</span><br><span class="line">        Request request = new Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .post(RequestBody.create(MediaType.parse(&quot;application/xml&quot;), body))</span><br><span class="line">                .build();</span><br><span class="line">        Call call = mOkHttpClient.newCall(request);</span><br><span class="line">        try &#123;</span><br><span class="line">            Response execute = call.execute();</span><br><span class="line">            result = execute.body().string();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static class Holder &#123;</span><br><span class="line">        private static final OkHttpUtil OK_HTTP_UTIL = new OkHttpUtil();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-腾讯地图调用工具类"><a href="#2-腾讯地图调用工具类" class="headerlink" title="2.腾讯地图调用工具类"></a>2.腾讯地图调用工具类</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">package com.gree.bdc.util;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.gree.bdc.entity.AddressToCoordinateResult;</span><br><span class="line">import com.gree.bdc.entity.CoordinateToAddressResult;</span><br><span class="line">import com.gree.bdc.entity.Point;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author hadoop</span><br><span class="line"> */</span><br><span class="line">public class MapUtil &#123;</span><br><span class="line">    private static final Logger log = LoggerFactory.getLogger(MapUtil.class);</span><br><span class="line"></span><br><span class="line">    //key需要自己申请</span><br><span class="line">    public static final String KEY = &quot;xxxx&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过地址转坐标</span><br><span class="line">     * @param address 地址</span><br><span class="line">     * @throws Exception exception</span><br><span class="line">     */</span><br><span class="line">  public static Point addressToCoordinate(String address) throws Exception &#123;</span><br><span class="line">      String url = &quot;https://apis.map.qq.com/ws/geocoder/v1/&quot;;</span><br><span class="line">      HashMap&lt;String, String&gt; params = new HashMap&lt;&gt;(8);</span><br><span class="line">      params.put(&quot;address&quot;,address);</span><br><span class="line">      params.put(&quot;key&quot;,KEY);</span><br><span class="line"></span><br><span class="line">      String result = OkHttpUtil.getInstance().get(url, params);</span><br><span class="line">      AddressToCoordinateResult addressToCoordinateResult = JSON.parseObject(result, AddressToCoordinateResult.class);</span><br><span class="line">      Integer status = addressToCoordinateResult.getStatus();</span><br><span class="line">      if (status == 0 )&#123;</span><br><span class="line">          AddressToCoordinateResult.Result.Location location = addressToCoordinateResult.getResult().getLocation();</span><br><span class="line">          Double lng = location.getLng();</span><br><span class="line">          Double lat = location.getLat();</span><br><span class="line">          Point point = new Point();</span><br><span class="line">          point.setLat(lat);</span><br><span class="line">          point.setLng(lng);</span><br><span class="line">          return point;</span><br><span class="line">      &#125;</span><br><span class="line">      return null;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">*两个坐标的距离</span><br><span class="line">*</span><br><span class="line">**/</span><br><span class="line">  public static Double distanceCalculate(double lat1, double lon1, double lat2, double lon2)&#123;</span><br><span class="line"></span><br><span class="line">          Double latitude1, longitude1, latitude2, longitude2;</span><br><span class="line">          Double dlat, dlon;</span><br><span class="line">          latitude1 = lat1;</span><br><span class="line">          longitude1 = lon1;</span><br><span class="line">          latitude2 = lat2;</span><br><span class="line">          longitude2 = lon2;</span><br><span class="line">          //computing procedure</span><br><span class="line">          Double a, c, distance;</span><br><span class="line"></span><br><span class="line">          dlon = Math.abs((longitude2 - longitude1)) * Math.PI / 180;</span><br><span class="line">          dlat = Math.abs((latitude2 - latitude1)) * Math.PI / 180;</span><br><span class="line">          a = (Math.sin(dlat / 2) * Math.sin(dlat / 2)) + Math.cos(latitude1 * Math.PI / 180) * Math.cos(latitude2 * Math.PI / 180) * (Math.sin(dlon / 2) * Math.sin(dlon / 2));</span><br><span class="line">          if (a == 1.0)&#123;</span><br><span class="line">              c = Math.PI;</span><br><span class="line">          &#125; else&#123;</span><br><span class="line">              c = 2 * Math.atan(Math.sqrt(a) / Math.sqrt(1 - a));</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">          distance = 6378137.0 * c;</span><br><span class="line">          return distance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过地址转坐标</span><br><span class="line">     * @param location 地址</span><br><span class="line">     * @throws Exception exception</span><br><span class="line">     */</span><br><span class="line">    public static String coordinateToAddress(String location) throws Exception &#123;</span><br><span class="line">        String url = &quot;https://apis.map.qq.com/ws/geocoder/v1/&quot;;</span><br><span class="line">        HashMap&lt;String, String&gt; params = new HashMap&lt;&gt;(8);</span><br><span class="line">        params.put(&quot;location&quot;,location);</span><br><span class="line">        params.put(&quot;key&quot;,KEY);</span><br><span class="line"></span><br><span class="line">        String result = OkHttpUtil.getInstance().get(url, params);</span><br><span class="line">        CoordinateToAddressResult coordinateToAddressResult = JSON.parseObject(result, CoordinateToAddressResult.class);</span><br><span class="line">        ///System.out.println(coordinateToAddressResult);</span><br><span class="line">        Integer status = coordinateToAddressResult.getStatus();</span><br><span class="line">        if (status == 0 )&#123;</span><br><span class="line">            String address = coordinateToAddressResult.getResult().getAddress();</span><br><span class="line"></span><br><span class="line">            return address;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一般而言，腾讯地图的接口调用都有限制，对于普通的开发者上线为10000，并发5次/s，不建议正规项目使用，一旦并发过高会导致很多的地址解析失败，单个解析没问题，很难发现这个问题，故最好还是申请企业认证，申请企业认证每天可以300万的次数和1000的并发。<a href="https://lbs.qq.com/service/webService/webServiceGuide/webServiceMatrix" target="_blank" rel="noopener">腾讯地图位置服务网站</a></p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-14T09:04:24.000Z">2020-04-14</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/数据库/">数据库 </a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    几秒 读完 (大约 99 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/14/mysql常见异常处理/">mysql常见异常处理</a>
            
        </h1>
        <div class="content">
            <h1 id="mysql异常处理"><a href="#mysql异常处理" class="headerlink" title="mysql异常处理"></a>mysql异常处理</h1><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">解决java.sql.SQLException: Value &apos;0000-00-00&apos; can not be represented as java.sql.Date</span><br><span class="line"></span><br><span class="line">jdbc:mysql://yourserver:3306/yourdatabase?zeroDateTimeBehavior=convertToNull</span><br></pre></td></tr></table></figure>
<p>#mysql文本类型数据存储<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql中text 最大长来度为65,535(2的16次方–1)字符的TEXT列。</span><br><span class="line">如果你觉得text长度自不够百，可以选择</span><br><span class="line">MEDIUMTEXT最大长度为16,777,215。</span><br><span class="line">LONGTEXT最大长度为4,294,967,295</span><br><span class="line">Text主要度是用来存放非二进制的文本</span><br></pre></td></tr></table></figure></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-11T02:11:31.000Z">2020-04-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/后台/">后台</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 分钟 读完 (大约 352 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/11/接口调试问题/">接口调试问题</a>
            
        </h1>
        <div class="content">
            <p>一、postman接口测试工具如何接收java.util.date参数</p>
<blockquote>
<p>时间格式采用：2020/04/11 14:12:14</p>
</blockquote>
<p>二、java 参数类型与mysql类型比较<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">===========java注入数据库==========</span><br><span class="line"></span><br><span class="line">java类型   mysql类型        成功与否</span><br><span class="line">date         date               yes</span><br><span class="line">date         time               no</span><br><span class="line">date         timestamp       no</span><br><span class="line">date         datetime         no</span><br><span class="line"></span><br><span class="line">time         date               no</span><br><span class="line">time         time               yes</span><br><span class="line">time         timestamp       no</span><br><span class="line">time         datetime         no</span><br><span class="line"></span><br><span class="line">timestamp date              yes</span><br><span class="line">timestamp time              yes</span><br><span class="line">timestamp timestamp     yes</span><br><span class="line">timestamp datetime        yes</span><br><span class="line">==========end java注入数据库========</span><br><span class="line">总规律，如果A完全包含B，则A可以向B注入数据，否则报错</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">==========从数据库提取到java ==========</span><br><span class="line"></span><br><span class="line">mysql类型    java类型     成与否</span><br><span class="line">date             date         yes</span><br><span class="line">date             time         yes --------------缺少的部分使用历元</span><br><span class="line">date           timestamp   yes --------------缺少的部分使用历元  </span><br><span class="line"></span><br><span class="line">time           date           yes --------------缺少的部分使用历元</span><br><span class="line">time           time           yes</span><br><span class="line">time          timestamp    yes --------------缺少的部分使用历元</span><br><span class="line"></span><br><span class="line">timestamp date           yes</span><br><span class="line">timestamp time           yes</span><br><span class="line">timestamp timestamp   yes</span><br><span class="line"></span><br><span class="line">datetime      date         yes</span><br><span class="line">datetime      time         yes</span><br><span class="line">datetime    timestamp   yes</span><br><span class="line">==========end 从数据库提取到java=======</span><br><span class="line">不会出错，缺少的部分使用历元，而不是当前日期时间</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">实战经验：在java中处理时间数据，建议采用java8中的时间工具类</span><br><span class="line">localtime</span><br><span class="line">localdate</span><br><span class="line">localdatetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在spark中处理时间的字段类型采用timestamp来计算，不要使用date类型计算</span><br><span class="line">mysql数据库中的日期类型字段采用date类型</span><br><span class="line">时间字段采用datetime 或者timestamp都可以，避免使用字符串，看起来更加正规。</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-09T01:54:23.000Z">2020-04-09</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 读完 (大约 1018 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/09/flink数据处理/">flink数据处理</a>
            
        </h1>
        <div class="content">
            <figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">package com.gree.bdc.device;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.google.gson.Gson;</span><br><span class="line">import com.gree.bdc.entity.DevicePosition;</span><br><span class="line">import com.gree.bdc.position.LongSpot;</span><br><span class="line">import com.gree.bdc.util.InitFlinkUtils;</span><br><span class="line">import org.apache.flink.api.common.serialization.SimpleStringSchema;</span><br><span class="line">import org.apache.flink.api.common.typeinfo.TypeHint;</span><br><span class="line">import org.apache.flink.api.common.typeinfo.TypeInformation;</span><br><span class="line">import org.apache.flink.api.java.functions.KeySelector;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple4;</span><br><span class="line">import org.apache.flink.streaming.api.TimeCharacteristic;</span><br><span class="line">import org.apache.flink.streaming.api.datastream.DataStreamSource;</span><br><span class="line">import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line">import org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line">import org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows;</span><br><span class="line">import org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line">import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumer;</span><br><span class="line"></span><br><span class="line">import java.sql.Timestamp;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 设备久置点计算</span><br><span class="line"> * @author hadoop</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class DeviceLongSpotInfo &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        System.setProperty(&quot;java.security.auth.login.config&quot;,&quot;/home/bdcopt/spark/jaas.conf&quot;);</span><br><span class="line">        System.setProperty(&quot;java.security.krb5.conf&quot;,&quot;/home/bdcopt/spark/krb5.conf&quot;);</span><br><span class="line"></span><br><span class="line">        StreamExecutionEnvironment env = InitFlinkUtils.getEnv();</span><br><span class="line">        env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</span><br><span class="line"></span><br><span class="line">        //读取kafka数据源</span><br><span class="line">        Properties properties = new Properties();</span><br><span class="line">        properties.setProperty(&quot;bootstrap.servers&quot;,&quot;kafka01:30001,kafka02:30002,kafka03:30003,kafka04:30004,kafka05:30005&quot;);</span><br><span class="line">        properties.setProperty(&quot;group.id&quot;,&quot;test&quot;);</span><br><span class="line">        properties.setProperty(&quot;auto.offset.reset&quot;,&quot;latest&quot;);</span><br><span class="line">        properties.setProperty(&quot;security.protocol&quot;,&quot;SASL_PLAINTEXT&quot;);</span><br><span class="line">        properties.setProperty(&quot;sasl.kerberos.service.name&quot;,&quot;kafka&quot;);</span><br><span class="line">        FlinkKafkaConsumer&lt;String&gt; kafkatopic0619 =</span><br><span class="line">                new FlinkKafkaConsumer&lt;String&gt;(&quot;test&quot;, new SimpleStringSchema(), properties);</span><br><span class="line">        kafkatopic0619.setStartFromLatest();</span><br><span class="line">        env.setParallelism(4);</span><br><span class="line">        DataStreamSource&lt;String&gt; sourceStream = env.addSource(kafkatopic0619);</span><br><span class="line"></span><br><span class="line">        //数据处理：</span><br><span class="line">        //1.按照设备id进行分组计算，按照每个久置点周期为一个窗口大小</span><br><span class="line">        // 2.移动距离为每个上报频率为滑动窗口的距离，计算在这个窗口的上报的设备点的距离与第一个设备的点的距离在</span><br><span class="line">        //可以接受的范围，那么这个点就是一个久置点。</span><br><span class="line"></span><br><span class="line">        sourceStream.map(value -&gt; &#123;</span><br><span class="line">            Gson gson = new Gson();</span><br><span class="line">            DevicePosition devicePosition = gson.fromJson(value, DevicePosition.class);</span><br><span class="line">            String imei = devicePosition.getImei();</span><br><span class="line">            Timestamp positionTime = devicePosition.getPosition_time();</span><br><span class="line">            String longitude = devicePosition.getLongitude();</span><br><span class="line">            String latitude = devicePosition.getLatitude();</span><br><span class="line">            return new Tuple4&lt;&gt;(positionTime,imei,latitude,longitude);</span><br><span class="line">        &#125;).returns(TypeInformation.of(new TypeHint&lt;Tuple4&lt;Timestamp, String, String, String&gt;&gt;() &#123;</span><br><span class="line">        &#125;)).assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor&lt;Tuple4&lt;Timestamp, String, String, String&gt;&gt;(Time.minutes(1)) &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public long extractTimestamp(Tuple4&lt;Timestamp, String, String, String&gt; element) &#123;</span><br><span class="line">                return element.f0.getTime();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).keyBy((KeySelector&lt;Tuple4&lt;Timestamp,String,String,String&gt;,String&gt;) map -&gt; map.f1)</span><br><span class="line">        .window(SlidingEventTimeWindows.of(Time.minutes(30L),Time.minutes(3L)))</span><br><span class="line">        .process(new LongSpot());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">package com.gree.bdc;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.google.gson.Gson;</span><br><span class="line">import com.gree.bdc.entity.DeviceLongSpot;</span><br><span class="line">import com.gree.bdc.entity.DevicePosition;</span><br><span class="line">import com.gree.bdc.entity.DeviceResidenceTime;</span><br><span class="line">import com.gree.bdc.position.LongSpotNew;</span><br><span class="line">import com.gree.bdc.sink.MysqlSink;</span><br><span class="line">import com.gree.bdc.util.DateUtils;</span><br><span class="line">import com.gree.bdc.util.InitFlinkUtils;</span><br><span class="line">import com.gree.bdc.util.MapUtils;</span><br><span class="line">import org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line">import org.apache.flink.api.common.functions.RichFlatMapFunction;</span><br><span class="line">import org.apache.flink.api.common.functions.RichMapFunction;</span><br><span class="line">import org.apache.flink.api.common.serialization.SimpleStringSchema;</span><br><span class="line">import org.apache.flink.api.common.state.StateTtlConfig;</span><br><span class="line">import org.apache.flink.api.common.state.ValueState;</span><br><span class="line">import org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line">import org.apache.flink.api.common.time.Time;</span><br><span class="line">import org.apache.flink.api.common.typeinfo.TypeHint;</span><br><span class="line">import org.apache.flink.api.common.typeinfo.TypeInformation;</span><br><span class="line">import org.apache.flink.api.java.functions.KeySelector;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple4;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple5;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple6;</span><br><span class="line">import org.apache.flink.configuration.Configuration;</span><br><span class="line">import org.apache.flink.streaming.api.TimeCharacteristic;</span><br><span class="line">import org.apache.flink.streaming.api.datastream.DataStreamSource;</span><br><span class="line">import org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line">import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line">import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumer;</span><br><span class="line">import org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line">import java.sql.Timestamp;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">public class ReadKafkaTest &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        StreamExecutionEnvironment env = InitFlinkUtils.getEnv();</span><br><span class="line">        env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</span><br><span class="line">        Properties properties = new Properties();</span><br><span class="line">        //properties.setProperty(&quot;bootstrap.servers&quot;,&quot;kafka01:30001,kafka02:30002,kafka03:30003,kafka04:30004,kafka05:30005&quot;);</span><br><span class="line">        properties.setProperty(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);</span><br><span class="line">        properties.setProperty(&quot;group.id&quot;,&quot;test&quot;);</span><br><span class="line">        FlinkKafkaConsumer&lt;String&gt; kafkatopic0619 =</span><br><span class="line">                new FlinkKafkaConsumer&lt;String&gt;(&quot;test08&quot;, new SimpleStringSchema(), properties);</span><br><span class="line">        kafkatopic0619.setStartFromLatest();</span><br><span class="line">        DataStreamSource&lt;String&gt; sourceStream = env.addSource(kafkatopic0619);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        SingleOutputStreamOperator&lt;Tuple6&lt;String,Timestamp,String,Double,Double,Long&gt;&gt; map = sourceStream.map(value -&gt; &#123;</span><br><span class="line">            Gson gson = new Gson();</span><br><span class="line">            DevicePosition devicePosition = gson.fromJson(value, DevicePosition.class);</span><br><span class="line">            String imei = devicePosition.getImei();</span><br><span class="line">            Timestamp positionTime = devicePosition.getPosition_time();</span><br><span class="line">            String longitude = devicePosition.getLongitude();</span><br><span class="line">            String latitude = devicePosition.getLatitude();</span><br><span class="line">            return new Tuple4&lt;&gt;(positionTime, imei, latitude, longitude);</span><br><span class="line">        &#125;).returns(TypeInformation.of(new TypeHint&lt;Tuple4&lt;Timestamp, String, String, String&gt;&gt;() &#123;</span><br><span class="line">        &#125;)).keyBy(1)</span><br><span class="line">                .map(new RichMapFunction&lt;Tuple4&lt;Timestamp, String, String, String&gt;, Tuple6&lt;String,Timestamp,String,Double,Double,Long&gt;&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                    private ValueState&lt;Tuple4&lt;Timestamp, String, String, String&gt;&gt; valueState;</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    public Tuple6&lt;String,Timestamp,String,Double,Double,Long&gt; map(Tuple4&lt;Timestamp, String, String, String&gt; value)</span><br><span class="line">                            throws Exception &#123;</span><br><span class="line">                        Tuple4&lt;Timestamp, String, String, String&gt; currentValue = valueState.value();</span><br><span class="line"></span><br><span class="line">                        System.out.println(&quot;刚开始的状态 ： &quot; + currentValue);</span><br><span class="line"></span><br><span class="line">                        if (currentValue == null) &#123;</span><br><span class="line">                            currentValue = Tuple4.of(value.f0, value.f1, value.f2, value.f3);</span><br><span class="line">                            valueState.update(currentValue);</span><br><span class="line">                        &#125;</span><br><span class="line">                        double currentLat = Double.parseDouble(currentValue.f2);</span><br><span class="line">                        double currentLong = Double.parseDouble(currentValue.f3);</span><br><span class="line">                        Timestamp currentTime = currentValue.f0;</span><br><span class="line"></span><br><span class="line">                        double valueLat = Double.parseDouble(value.f2);</span><br><span class="line">                        double valueLong = Double.parseDouble(value.f3);</span><br><span class="line">                        Timestamp valueTime = value.f0;</span><br><span class="line"></span><br><span class="line">                        Double distanceCalculate = MapUtils.distanceCalculate(currentLat, currentLong, valueLat, valueLong);</span><br><span class="line"></span><br><span class="line">                        Long min = DateUtils.dateSubtraction(currentTime.toString(), valueTime.toString());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        System.out.println(distanceCalculate);</span><br><span class="line">                        System.out.println(&quot;状态点： &quot; + currentValue);</span><br><span class="line">                        System.out.println(&quot;当前数据： &quot; + value);</span><br><span class="line"></span><br><span class="line">                        if (distanceCalculate &gt; 500) &#123;</span><br><span class="line">                            currentValue.f0 = value.f0;</span><br><span class="line">                            currentValue.f1 = value.f1;</span><br><span class="line">                            currentValue.f2 = value.f2;</span><br><span class="line">                            currentValue.f3 = value.f3;</span><br><span class="line">                            valueState.update(currentValue);</span><br><span class="line">                            if (min &gt; 30) &#123;</span><br><span class="line">                                return Tuple6.of(&quot;久置点&quot;, currentTime, value.f1, currentLat, currentLong, min);</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                return Tuple6.of(&quot;非久置点&quot;, currentTime, value.f1, currentLat, currentLong, min);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        return Tuple6.of(&quot;邻域点&quot;, currentTime, value.f1, currentLat, currentLong, min);</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    public void open(Configuration parameters) throws Exception &#123;</span><br><span class="line">                        super.open(parameters);</span><br><span class="line"></span><br><span class="line">                        // keyedState可以设置TTL过期时间</span><br><span class="line">//                        StateTtlConfig config= StateTtlConfig</span><br><span class="line">//                                .newBuilder(Time.seconds(30))</span><br><span class="line">//                                .setStateVisibility(StateTtlConfig.StateVisibility.NeverReturnExpired)</span><br><span class="line">//                                .setUpdateType(StateTtlConfig.UpdateType.OnCreateAndWrite)</span><br><span class="line">//                                .build();</span><br><span class="line"></span><br><span class="line">                        ValueStateDescriptor valueStateDescriptor = new ValueStateDescriptor(&quot;agvKeyedState&quot;,</span><br><span class="line">                                TypeInformation.of(new TypeHint&lt;Tuple4&lt;Timestamp, String, String, String&gt;&gt;() &#123;</span><br><span class="line">                                &#125;));</span><br><span class="line"></span><br><span class="line">                        //设置支持TTL配置</span><br><span class="line">//                        valueStateDescriptor.enableTimeToLive(config);</span><br><span class="line"></span><br><span class="line">                        valueState = getRuntimeContext().getState(valueStateDescriptor);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        SingleOutputStreamOperator&lt;Tuple6&lt;String, Timestamp, String, Double, Double, Long&gt;&gt; filter = map.filter(value -&gt; &#123;</span><br><span class="line">            return value.f0.equals(&quot;久置点&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        filter.addSink(new MysqlSink());</span><br><span class="line"></span><br><span class="line">        env.execute(&quot;read-kafka-test&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-08T01:46:21.000Z">2020-04-08</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/大数据/">大数据</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    12 分钟 读完 (大约 1771 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/08/spark-读取-kafka-并写入mysql/">spark 读取 kafka 并写入mysql</a>
            
        </h1>
        <div class="content">
            <h3 id="spark-maven-依赖"><a href="#spark-maven-依赖" class="headerlink" title="spark maven 依赖"></a>spark maven 依赖</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.gree.bdc&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;dispatch-kafka-installer&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;spark.version&gt;2.4.0&lt;/spark.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- spark start--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spark-core_2.11&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spark-hive_2.11&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spark-sql_2.11&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- spark end --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- structStreaming kafka --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spark-sql-kafka-0-10_2.11&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- sparkStreaming kafka --&gt;</span><br><span class="line">        &lt;!-- 建议新集群使用sparkStreaming处理kafka数据--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spark-streaming-kafka-0-10_2.11&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spark-streaming_2.11&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.4.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 数据库连接--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;8.0.12&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 数据库连接 end --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 常用工具 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.18.2&lt;/version&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.58&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- 常用工具 end --&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.5.5&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;archive&gt;</span><br><span class="line">                        &lt;manifest&gt;</span><br><span class="line">                            &lt;mainClass&gt;&lt;/mainClass&gt;</span><br><span class="line">                        &lt;/manifest&gt;</span><br><span class="line">                    &lt;/archive&gt;</span><br><span class="line">                    &lt;descriptorRefs&gt;</span><br><span class="line">                        &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;</span><br><span class="line">                    &lt;/descriptorRefs&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;make-assembly&lt;/id&gt;</span><br><span class="line">                        &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;single&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.1&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<h3 id="读取kafka-写入mysql"><a href="#读取kafka-写入mysql" class="headerlink" title="读取kafka ,写入mysql"></a>读取kafka ,写入mysql</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">package com.gree.bdc.installer;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.gree.bdc.entity.InstallerInfo;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line">import org.apache.kafka.common.serialization.StringDeserializer;</span><br><span class="line">import org.apache.spark.api.java.JavaRDD;</span><br><span class="line">import org.apache.spark.sql.*;</span><br><span class="line">import org.apache.spark.streaming.Durations;</span><br><span class="line">import org.apache.spark.streaming.api.java.JavaInputDStream;</span><br><span class="line">import org.apache.spark.streaming.api.java.JavaStreamingContext;</span><br><span class="line">import org.apache.spark.streaming.kafka010.ConsumerStrategies;</span><br><span class="line">import org.apache.spark.streaming.kafka010.KafkaUtils;</span><br><span class="line">import org.apache.spark.streaming.kafka010.LocationStrategies;</span><br><span class="line"></span><br><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 读取kafka</span><br><span class="line"> * @author hadoop</span><br><span class="line"> * @date 2020-03-26</span><br><span class="line"> */</span><br><span class="line">public class ReadKafkaInstaller &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        ///本地测试</span><br><span class="line">        //System.setProperty(&quot;java.security.auth.login.config&quot;,  &quot;E:\\workspace\\dispatch-kafka-data\\src\\main\\resources\\jaas.conf&quot;);</span><br><span class="line">        //System.setProperty(&quot;java.security.krb5.conf&quot;, &quot;E:\\workspace\\dispatch-kafka-data\\src\\main\\resources\\krb5.conf&quot;);</span><br><span class="line"></span><br><span class="line">        //服务器上跑</span><br><span class="line">        System.setProperty(&quot;java.security.auth.login.config&quot;,&quot;/home/bdcopt/spark/jaas.conf&quot;);</span><br><span class="line">        System.setProperty(&quot;java.security.krb5.conf&quot;,&quot;/home/bdcopt/spark/krb5.conf&quot;);</span><br><span class="line"></span><br><span class="line">        SparkSession spark = SparkSession.builder()</span><br><span class="line">                .appName(&quot;dispatch-installer&quot;)</span><br><span class="line">                .master(&quot;local[2]&quot;)</span><br><span class="line">                .config(&quot;spark.serializer&quot;,&quot;org.apache.spark.serializer.KryoSerializer&quot;)</span><br><span class="line">                .config( &quot;spark.driver.allowMultipleContexts&quot;,true )</span><br><span class="line">                .getOrCreate();</span><br><span class="line"></span><br><span class="line">        // 读取kafka配置</span><br><span class="line">        Map&lt;String,Object&gt; kafkaParams = new HashMap&lt;&gt;( 16);</span><br><span class="line">        kafkaParams.put( &quot;bootstrap.servers&quot;,&quot;kafka01:30001,kafka02:30002,kafka03:30003,kafka04:30004,kafka05:30005&quot; );</span><br><span class="line">        kafkaParams.put(&quot;key.deserializer&quot;, StringDeserializer.class);</span><br><span class="line">        kafkaParams.put(&quot;value.deserializer&quot;, StringDeserializer.class);</span><br><span class="line">        kafkaParams.put(&quot;group.id&quot;, &quot;dispatchInstaller297&quot;);</span><br><span class="line">        kafkaParams.put(&quot;auto.offset.reset&quot;, &quot;latest&quot;);</span><br><span class="line">        kafkaParams.put(&quot;security.protocol&quot;,&quot;SASL_PLAINTEXT&quot; );</span><br><span class="line">        kafkaParams.put(&quot;sasl.kerberos.service.name&quot;,&quot;kafka&quot; );</span><br><span class="line">        kafkaParams.put(&quot;enable.auto.commit&quot;, true);</span><br><span class="line"></span><br><span class="line">        Collection&lt;String&gt; topics = Collections.singletonList(&quot;dispatchInstaller&quot;);</span><br><span class="line">        JavaStreamingContext javaStreamingContext = new JavaStreamingContext( spark.sparkContext().conf(),</span><br><span class="line">                Durations.seconds( 1 ));</span><br><span class="line"></span><br><span class="line">        JavaInputDStream&lt;ConsumerRecord&lt;String, String&gt;&gt; stream =</span><br><span class="line">                KafkaUtils.createDirectStream(</span><br><span class="line">                        javaStreamingContext,</span><br><span class="line">                        LocationStrategies.PreferConsistent(),</span><br><span class="line">                        ConsumerStrategies.Subscribe(topics, kafkaParams)</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //数据遍历写入mysql</span><br><span class="line">        stream.foreachRDD((rdd,time) -&gt;&#123;</span><br><span class="line">            JavaRDD&lt;InstallerInfo&gt; installerInfoJavaRdd = rdd.map(stringValue -&gt; JSON.parseObject(stringValue.value(), InstallerInfo.class));</span><br><span class="line">            Dataset&lt;Row&gt; installerInfoDataFrame = spark.createDataFrame(installerInfoJavaRdd, InstallerInfo.class);</span><br><span class="line">///           String url = &quot;jdbc:mysql://localhost:3306/gpsdev?serverTimezone=GMT&amp;autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&quot;;</span><br><span class="line">//            //rm-wz9k56kkaxj0e9mct33150.mysql.rds.aliyuncs.com</span><br><span class="line">//            String tableName = &quot;assign_ls_lc&quot;;</span><br><span class="line">//            Properties prop = new Properties();</span><br><span class="line">//            prop.put(&quot;user&quot;,&quot;root&quot;);</span><br><span class="line">//            prop.put(&quot;password&quot;,&quot;123456&quot;);</span><br><span class="line">//            prop.put(&quot;driver&quot;,&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line"></span><br><span class="line">            //新增自增id</span><br><span class="line">//            StructType schema = installerInfoDataFrame.schema().add(DataTypes.createStructField(&quot;id&quot;, DataTypes.LongType, false));</span><br><span class="line">//            JavaRDD&lt;Row&gt; installerInfoDataFrameRdd = installerInfoDataFrame</span><br><span class="line">//                    .javaRDD() // 转为JavaRDD</span><br><span class="line">//                    .zipWithIndex() // 添加索引，结果为JavaPairRDD&lt;Row, Long&gt;，即行数据和对应的索引</span><br><span class="line">//                    .map(new Function&lt;Tuple2&lt;Row, Long&gt;, Row&gt;() &#123;</span><br><span class="line">//                        @Override</span><br><span class="line">//                        public Row call(Tuple2&lt;Row, Long&gt; v1) throws Exception &#123;</span><br><span class="line">//                            Object[] objects = new Object[v1._1.size() + 1];</span><br><span class="line">//                            for (int i = 0; i &lt; v1._1.size(); i++) &#123;</span><br><span class="line">//                                objects[i] = v1._1.get(i);</span><br><span class="line">//                            &#125;</span><br><span class="line">//                            objects[objects.length - 1] = v1._2;</span><br><span class="line">//                            return RowFactory.create(objects);</span><br><span class="line">//                        &#125;</span><br><span class="line">//                    &#125;); // 把索引值作为ID字段值，构造新的行数据</span><br><span class="line"></span><br><span class="line">//            installerInfoDataFrame = spark.createDataFrame(installerInfoDataFrameRdd, schema);</span><br><span class="line"></span><br><span class="line">            String url = &quot;jdbc:mysql://localhost:3306/paigong_map?serverTimezone=GMT&amp;autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&quot;;</span><br><span class="line">            String tableName = &quot;t_installer_original_info&quot;;</span><br><span class="line">            Properties prop = new Properties();</span><br><span class="line">            prop.put(&quot;user&quot;,&quot;paigong_map&quot;);</span><br><span class="line">            prop.put(&quot;password&quot;,&quot;paigong_map@dept1&quot;);</span><br><span class="line">            prop.put(&quot;driver&quot;,&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line">            installerInfoDataFrame.write().mode( SaveMode.Append).jdbc(url,tableName,prop);</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">        //启动程序</span><br><span class="line">        javaStreamingContext.start();</span><br><span class="line">        try &#123;</span><br><span class="line">            javaStreamingContext.awaitTermination();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">// TODO Auto-generated catch block</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>采用上述方式写入mysql 速度较快，但是也有局限性，它仅适用于新增的模式，大批量的导入，对于数据量较小，而且需要更灵活导入（如 更新操作）时建议采用原生的kafka消费者</p>
</blockquote>
<h3 id="kafka-consumer"><a href="#kafka-consumer" class="headerlink" title="kafka consumer"></a>kafka consumer</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.gree.bdc&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;dispatch-kafka-order-consumer&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--引入kafka-client依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.62&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.18.2&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;!-- 数据库连接--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.1.12&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.44&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- 数据库连接 end --&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.5.5&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;archive&gt;</span><br><span class="line">                        &lt;manifest&gt;</span><br><span class="line">                            &lt;mainClass&gt;&lt;/mainClass&gt;</span><br><span class="line">                        &lt;/manifest&gt;</span><br><span class="line">                    &lt;/archive&gt;</span><br><span class="line">                    &lt;descriptorRefs&gt;</span><br><span class="line">                        &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;</span><br><span class="line">                    &lt;/descriptorRefs&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;make-assembly&lt;/id&gt;</span><br><span class="line">                        &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;single&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.1&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p>consumer.properties<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#配置消费者集群</span><br><span class="line">bootstrap.servers=kafka01:30001</span><br><span class="line">#消费者的组ID，</span><br><span class="line">group.id=</span><br><span class="line">enable.auto.commit=true</span><br><span class="line">session.timeout.ms=300000</span><br><span class="line">#消费策略</span><br><span class="line">auto.offset.reset=earliest</span><br><span class="line">#实现了Serializer接口的序列化类。用于告诉kafka如何序列化key</span><br><span class="line">key.deserializer=org.apache.kafka.common.serialization.StringDeserializer</span><br><span class="line">#实现了Serializer接口的序列化类。用于告诉kafka如何序列化value</span><br><span class="line">value.deserializer=org.apache.kafka.common.serialization.StringDeserializer</span><br><span class="line">security.protocol=SASL_PLAINTEXT</span><br><span class="line">sasl.kerberos.service.name=kafka</span><br></pre></td></tr></table></figure></p>
<p>druid.properties<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">driverClassName=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://localhost:3306/test?serverTimezone=GMT&amp;autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span><br><span class="line">username=root</span><br><span class="line">password=123456</span><br><span class="line">initialSize=5</span><br><span class="line">maxActive=20</span><br><span class="line">maxWait=3000</span><br><span class="line">minIdle=3</span><br></pre></td></tr></table></figure></p>
<p>jaas.conf<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">KafkaClient &#123;</span><br><span class="line">  com.sun.security.auth.module.Krb5LoginModule required</span><br><span class="line">  doNotPrompt=true</span><br><span class="line">  useKeyTab=true</span><br><span class="line">  storeKey=true</span><br><span class="line">  renewTicket=true</span><br><span class="line">  keyTab=&quot;E:\\test.keytab&quot;</span><br><span class="line">  principal=&quot;test&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Client &#123;</span><br><span class="line">  com.sun.security.auth.module.Krb5LoginModule required</span><br><span class="line">  useKeyTab=true</span><br><span class="line">  storeKey=true</span><br><span class="line">  keyTab=&quot;test.keytab&quot;</span><br><span class="line">  principal=&quot;test&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>krb5.conf等配置文件<br>创建消费者<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">package com.gree.bdc.consumer;</span><br><span class="line"></span><br><span class="line">import org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author :yelinlin()</span><br><span class="line"> * @date :2019/3/10</span><br><span class="line"> * @description :消费者</span><br><span class="line"> */</span><br><span class="line">public class Consumer &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 获得一个Kafka消费者</span><br><span class="line">     * @return kafkaConsumer</span><br><span class="line">     */</span><br><span class="line">    public KafkaConsumer&lt;String,String&gt; getConsumer ()&#123;</span><br><span class="line">        //配置读取配置文件</span><br><span class="line">        System.setProperty(&quot;java.security.auth.login.config&quot;,  &quot;/home/bdcopt/spark/jaas.conf&quot;);</span><br><span class="line">        System.setProperty(&quot;java.security.krb5.conf&quot;, &quot;/home/bdcopt/spark/krb5.conf&quot;);</span><br><span class="line">        Properties props = new Properties();</span><br><span class="line">        try &#123;</span><br><span class="line">            //获取kafka消费者配置信息</span><br><span class="line">            props.load(this.getClass().getResourceAsStream(&quot;/consumer.properties&quot;));</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return new KafkaConsumer&lt;String,String&gt;(props);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>读取数据写入mysql</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package com.gree.bdc.order;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.gree.bdc.consumer.Consumer;</span><br><span class="line">import com.gree.bdc.entity.DispatchInfo;</span><br><span class="line">import com.gree.bdc.util.DateUtils;</span><br><span class="line">import com.gree.bdc.util.DruidPoolUtils;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line">import org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.PreparedStatement;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.text.ParseException;</span><br><span class="line">import java.util.Collections;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author yelinlin (260269)</span><br><span class="line"> * @createTime 2019/11/21</span><br><span class="line"> * @description kafka消费者启动类</span><br><span class="line"> */</span><br><span class="line">public class OrderConsumerStarter &#123;</span><br><span class="line">    private static final String TOPIC=&quot;test&quot;;</span><br><span class="line">    private static final Logger logger= LoggerFactory.getLogger(OrderConsumerStarter.class);</span><br><span class="line">    public static void main(String[] args) throws SQLException, ParseException &#123;</span><br><span class="line">        Connection connection;</span><br><span class="line">        PreparedStatement statement;</span><br><span class="line">        //获取一个消费者</span><br><span class="line">        KafkaConsumer&lt;String,String&gt; consumer = new Consumer().getConsumer();</span><br><span class="line">        consumer.subscribe(Collections.singletonList(TOPIC));</span><br><span class="line">        //消费并打印消费结果</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            //进行消费</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(100);</span><br><span class="line">            for (ConsumerRecord&lt;String,String&gt; record: records) &#123;</span><br><span class="line">                connection = DruidPoolUtils.getConnection();</span><br><span class="line">                DispatchInfo dispatchInfo = JSON.parseObject(record.value(), DispatchInfo.class);</span><br><span class="line">                //写入mysql</span><br><span class="line">                statement = connection.prepareStatement(&quot;&quot; +</span><br><span class="line">                        &quot;insert into paigong_map.t_dispatch_info (customer_address,customer_name,&quot; +</span><br><span class="line">                        &quot; customer_tel,dispatching_time,finish_time,installation_number,order_number,&quot; +</span><br><span class="line">                        &quot; unfinish_number,work_number) values(?,?,?,?,?,?,?,?,?)&quot;);</span><br><span class="line">                statement.setString(1,dispatchInfo.getCustomer_address());</span><br><span class="line">                statement.setString(2,dispatchInfo.getCustomer_name());</span><br><span class="line">                statement.setString(3,dispatchInfo.getCustomer_tel());</span><br><span class="line">                statement.setString(4,DateUtils.dealDateFormat(dispatchInfo.getDispatching_time()));</span><br><span class="line">                statement.setString(5,DateUtils.dealDateFormat(dispatchInfo.getFinish_time()));</span><br><span class="line">                statement.setDouble(6,dispatchInfo.getInstallation_number());</span><br><span class="line">                statement.setString(7,dispatchInfo.getOrder_number());</span><br><span class="line">                statement.setDouble(8,dispatchInfo.getUnfinish_number());</span><br><span class="line">                statement.setString(9,dispatchInfo.getWork_number().split(&quot;\\.&quot;)[0]);</span><br><span class="line">                statement.execute();</span><br><span class="line">                DruidPoolUtils.close(connection,statement);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>补充下数据库连接池工具类<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">package com.gree.bdc.util;</span><br><span class="line"></span><br><span class="line">import com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.ResultSet;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.sql.Statement;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Druid 数据库连接池</span><br><span class="line"> * @author hadoop</span><br><span class="line"> * @date 2020-04-06</span><br><span class="line"> */</span><br><span class="line">public class DruidPoolUtils &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建成员变量,获取数据源</span><br><span class="line">     */</span><br><span class="line">    private static DataSource dataSource;</span><br><span class="line">    //加载配置文件</span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Properties properties = new Properties();</span><br><span class="line">//加载类路径</span><br><span class="line">            properties.load(DruidPoolUtils.class.getResourceAsStream(&quot;/druid.properties&quot;));</span><br><span class="line"></span><br><span class="line">//读取属性文件，创建连接池</span><br><span class="line">            dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取数据源</span><br><span class="line">     * @return 数据源</span><br><span class="line">     */</span><br><span class="line">    public static DataSource getDataSource()&#123;</span><br><span class="line">        return dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取连接对象</span><br><span class="line">     * @return 连接对象</span><br><span class="line">     */</span><br><span class="line">    public static Connection getConnection()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return dataSource.getConnection();</span><br><span class="line">        &#125;catch (SQLException e)&#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //释放资源</span><br><span class="line"></span><br><span class="line">    private static void close(Connection connection, Statement statement, ResultSet resultSet)&#123;</span><br><span class="line">        if (resultSet != null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (statement != null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;catch (SQLException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (connection != null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;catch (SQLException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void close(Connection connection,Statement statement)&#123;</span><br><span class="line">        close(connection,statement,null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="spark自定义批量写入mysql"><a href="#spark自定义批量写入mysql" class="headerlink" title="spark自定义批量写入mysql"></a>spark自定义批量写入mysql</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> //自定义批量写入mysql</span><br><span class="line">        dispatchChange.foreachPartition(new ForeachPartitionFunction&lt;Row&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void call(Iterator&lt;Row&gt; t) throws Exception &#123;</span><br><span class="line">//                while(t.hasNext())&#123;</span><br><span class="line">//                    System.out.println(t.next());</span><br><span class="line">//                &#125;</span><br><span class="line">                PreparedStatement statement;</span><br><span class="line">                Connection connection = DruidPoolUtils.getConnection();</span><br><span class="line">                statement = connection.prepareStatement(&quot;replace into test&quot; +</span><br><span class="line">                        &quot;  (dispatching_time,order_number,imei,work_number,driver_name,license_plate,&quot; +</span><br><span class="line">                        &quot; installation_number,unfinish_number,customer_address,arrive_time,finish_time,&quot; +</span><br><span class="line">                        &quot; leave_time,total_time,average_time,order_status,affiliation,prod_id) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)&quot;);</span><br><span class="line"></span><br><span class="line">                while(t.hasNext())&#123;</span><br><span class="line">                    Row next = t.next();</span><br><span class="line">                    statement.setTimestamp(1,next.getTimestamp(0));</span><br><span class="line">                    statement.setString(2,next.getString(1));</span><br><span class="line">                    statement.setString(3,next.getString(2));</span><br><span class="line">                    statement.setString(4,next.getString(3));</span><br><span class="line">                    statement.setString(5,next.getString(4));</span><br><span class="line">                    statement.setString(6,next.getString(5));</span><br><span class="line">                    statement.setDouble(7,next.getDouble(6));</span><br><span class="line">                    statement.setDouble(8,next.getDouble(7));</span><br><span class="line">                    statement.setString(9,next.getString(8));</span><br><span class="line">                    statement.setTimestamp(10,next.getTimestamp(9));</span><br><span class="line">                    statement.setTimestamp(11,next.getTimestamp(10));</span><br><span class="line">                    statement.setTimestamp(12,next.getTimestamp(11));</span><br><span class="line">                    statement.setDouble(13,next.getDouble(12));</span><br><span class="line">                    statement.setDouble(14,next.getDouble(13));</span><br><span class="line">                    statement.setInt(15,next.getInt(14));</span><br><span class="line">                    statement.setString(16,next.getString(15));</span><br><span class="line">                    statement.setString(17,next.getString(16));</span><br><span class="line"></span><br><span class="line">                    statement.addBatch();</span><br><span class="line">                &#125;</span><br><span class="line">                statement.executeBatch();</span><br><span class="line">                DruidPoolUtils.close(connection,statement);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-07T11:28:53.000Z">2020-04-07</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/大数据/">大数据</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 分钟 读完 (大约 611 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/07/spark-常用操作/">spark 常用操作</a>
            
        </h1>
        <div class="content">
            <h3 id="一、spark-分组计算（转rdd-分组计算完再转回-dateset）"><a href="#一、spark-分组计算（转rdd-分组计算完再转回-dateset）" class="headerlink" title="一、spark 分组计算（转rdd 分组计算完再转回 dateset）"></a>一、spark 分组计算（转rdd 分组计算完再转回 dateset）</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">JavaRDD&lt;Row&gt; rowJavaRdd = orderDistanceCustomer.javaRDD();</span><br><span class="line">JavaRDD&lt;OrderLeaveTime&gt; leaveTimeJavaRDD = rowJavaRdd.groupBy(row -&gt; row.getString(1))</span><br><span class="line">              .map(new Function&lt;Tuple2&lt;String, Iterable&lt;Row&gt;&gt;, OrderLeaveTime&gt;() &#123;</span><br><span class="line">                  @Override</span><br><span class="line">                  public OrderLeaveTime call(Tuple2&lt;String, Iterable&lt;Row&gt;&gt; v1) throws Exception &#123;</span><br><span class="line">                      String order_number = v1._1;</span><br><span class="line">                      Iterator&lt;Row&gt; iterator = v1._2.iterator();</span><br><span class="line">                      String report_time = &quot;&quot;;</span><br><span class="line">                      String flag = &quot;&quot;;</span><br><span class="line">                      while (iterator.hasNext()) &#123;</span><br><span class="line">                          Row next = iterator.next();</span><br><span class="line">                          double order_distance_customer = next.getDouble(14);</span><br><span class="line">                          report_time = next.getString(11);</span><br><span class="line">                          if (order_distance_customer - 2000 &lt; 0) &#123;</span><br><span class="line">                              flag = &quot;已进入&quot;;</span><br><span class="line">                          &#125;</span><br><span class="line">                          if (&quot;已进入&quot;.equals(flag) &amp;&amp; order_distance_customer - 2000 &gt; 0) &#123;</span><br><span class="line">                              break;</span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                      OrderLeaveTime orderArriveTime1 = new OrderLeaveTime();</span><br><span class="line">                      orderArriveTime1.setOrderNumber(order_number);</span><br><span class="line">                      orderArriveTime1.setLeaveTime(report_time);</span><br><span class="line">                      return orderArriveTime1;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;);</span><br><span class="line"></span><br><span class="line">      Encoder&lt;OrderLeaveTime&gt; orderLeaveTimeEncode = Encoders.bean(OrderLeaveTime.class);</span><br><span class="line">      Dataset&lt;OrderLeaveTime&gt; leaveTimeDataset = spark.createDataset(leaveTimeJavaRDD.rdd(),orderLeaveTimeEncode);</span><br></pre></td></tr></table></figure>
<h2 id="二、spark-dataset-分组计算（使用groupbyKey）"><a href="#二、spark-dataset-分组计算（使用groupbyKey）" class="headerlink" title="二、spark dataset 分组计算（使用groupbyKey）"></a>二、spark dataset 分组计算（使用groupbyKey）</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Dataset&lt;DeviceLocation&gt; deviceLocationDataset = devicePosition.groupByKey(new MapFunction&lt;Row, String&gt;() &#123;</span><br><span class="line">           @Override</span><br><span class="line">           public String call(Row value) throws Exception &#123;</span><br><span class="line">               return value.getString(2);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;, Encoders.STRING()).flatMapGroups(new FlatMapGroupsFunction&lt;String, Row, DeviceLocation&gt;() &#123;</span><br><span class="line">           @Override</span><br><span class="line">           public Iterator&lt;DeviceLocation&gt; call(String key, Iterator&lt;Row&gt; values) throws Exception &#123;</span><br><span class="line">               List&lt;DeviceLocation.Location&gt; locations = new ArrayList&lt;&gt;();</span><br><span class="line">               while (values.hasNext()) &#123;</span><br><span class="line">                   DeviceLocation.Location location = new DeviceLocation.Location();</span><br><span class="line">                   Row next = values.next();</span><br><span class="line">                   location.setId((int)next.getLong(0));</span><br><span class="line">                   location.setLocation_code(next.getString(1));</span><br><span class="line">                   location.setLongitude(next.getString(3));</span><br><span class="line">                   location.setLongmark(next.getString(4));</span><br><span class="line">                   location.setLatitude(next.getString(5));</span><br><span class="line">                   location.setLati_mark(next.getString(6));</span><br><span class="line">                   location.setPosition_time(next.getTimestamp(7));</span><br><span class="line">                   location.setSignal_strength(next.getString(8));</span><br><span class="line">                   location.setPower(next.getString(9));</span><br><span class="line">                   location.setAlarm_status(next.getString(10));</span><br><span class="line">                   location.setExtended_data(next.getString(11));</span><br><span class="line">                   locations.add(location);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               DeviceLocation deviceLocation = new DeviceLocation();</span><br><span class="line">               deviceLocation.setImei(key);</span><br><span class="line">               deviceLocation.setDateTime(&quot;2020-04-05&quot;);</span><br><span class="line">               deviceLocation.setLocation(JSON.toJSONString(locations));</span><br><span class="line">               ArrayList&lt;DeviceLocation&gt; deviceLocations = new ArrayList&lt;&gt;();</span><br><span class="line">               deviceLocations.add(deviceLocation);</span><br><span class="line">               return deviceLocations.iterator();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;, Encoders.bean(DeviceLocation.class));</span><br><span class="line"></span><br><span class="line">       deviceLocationDataset.select(col(&quot;imei&quot;),col(&quot;dateTime&quot;),col(&quot;location&quot;).cast(&quot;String&quot;)).write().mode(SaveMode.Append).jdbc(url,&quot;test&quot;,properties);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="spark-分组计算"><a href="#spark-分组计算" class="headerlink" title="spark 分组计算"></a>spark 分组计算</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//Encoder&lt;OrderArriveTime&gt; orderArriveTimeEncoder = Encoders.bean(OrderArriveTime.class);</span><br><span class="line"></span><br><span class="line"> //通过转成list来遍历得到数据</span><br><span class="line">//        List&lt;OrderArriveTime&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">//        //效率太低，考虑自定义函数</span><br><span class="line">//        List&lt;OrderArriveTime&gt; orderArriveTimes = orderArriveTimeDataset.collectAsList();</span><br><span class="line">//        orderArriveTimes.stream().collect(Collectors.groupingBy(OrderArriveTime::getCustomerAddress))</span><br><span class="line">//                .forEach(new BiConsumer&lt;String, List&lt;OrderArriveTime&gt;&gt;() &#123;</span><br><span class="line">//                    @Override</span><br><span class="line">//                    public void accept(String s, List&lt;OrderArriveTime&gt; orderArriveTimes) &#123;</span><br><span class="line">//</span><br><span class="line">//                        String arriveTime = null;</span><br><span class="line">//                        String finishTime = null;</span><br><span class="line">//</span><br><span class="line">//                        for (OrderArriveTime next : orderArriveTimes) &#123;</span><br><span class="line">//                            OrderArriveTime orderArriveTime = new OrderArriveTime();</span><br><span class="line">//                            if (arriveTime == null) &#123;</span><br><span class="line">//                                arriveTime = next.getArriveTime();</span><br><span class="line">//                            &#125; else &#123;</span><br><span class="line">//                                arriveTime = finishTime;</span><br><span class="line">//                            &#125;</span><br><span class="line">//                            finishTime = next.getFinishTime();</span><br><span class="line">//                            orderArriveTime.setOrderNumber(next.getOrderNumber());</span><br><span class="line">//                            orderArriveTime.setCustomerAddress(next.getCustomerAddress());</span><br><span class="line">//                            orderArriveTime.setArriveTime(arriveTime);</span><br><span class="line">//                            orderArriveTime.setFinishTime(finishTime);</span><br><span class="line">//                            list.add(orderArriveTime);</span><br><span class="line">//                        &#125;</span><br><span class="line">//</span><br><span class="line">//                    &#125;</span><br><span class="line">//                &#125;);</span><br><span class="line">//</span><br><span class="line">//        Dataset&lt;OrderArriveTime&gt; realArriveDataset = spark.createDataset(list, orderArriveTimeEncoder);</span><br></pre></td></tr></table></figure>
<h3 id="spark-自定义函数"><a href="#spark-自定义函数" class="headerlink" title="spark 自定义函数"></a>spark 自定义函数</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">时间格式转换自定义函数</span><br><span class="line">//        spark.udf().register(&quot;TimeFormat&quot;, new UDF1&lt;String, String&gt;() &#123;</span><br><span class="line">//            @Override</span><br><span class="line">//            public String call(String oldDateStr) throws Exception &#123;</span><br><span class="line">//                if (oldDateStr != null)&#123;</span><br><span class="line">//                    DateFormat df = new SimpleDateFormat(&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSSXXX&quot;);</span><br><span class="line">//                    Date date = df.parse(oldDateStr);</span><br><span class="line">//                    SimpleDateFormat df1 = new SimpleDateFormat (&quot;EEE MMM dd HH:mm:ss Z yyyy&quot;, Locale.UK);</span><br><span class="line">//                    Date date1 =  df1.parse(date.toString());</span><br><span class="line">//                    DateFormat df2 = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">//                    return df2.format(date1);</span><br><span class="line">//                &#125;</span><br><span class="line">//              return null;</span><br><span class="line">//            &#125;</span><br><span class="line">//        &#125;, DataTypes.StringType);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> //自定义函数适应于多列数据通过逻辑处理得到一列数据的情况</span><br><span class="line"> //定义自定义函数</span><br><span class="line">        spark.udf().register(&quot;orderDistanceCustomer&quot;, (UDF4&lt;Double, Double, Double, Double, Double&gt;)</span><br><span class="line">                (lat1, lon1, lat2, lon2) -&gt; &#123;</span><br><span class="line">            if (lat1 != null &amp;&amp; lon1 != null &amp;&amp; lat2 != null &amp;&amp; lon2 != null)&#123;</span><br><span class="line">                return MapUtil.distanceCalculate(lat1, lon1, lat2, lon2);</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                return -1.0;</span><br><span class="line">            &#125; &#125;, DataTypes.DoubleType);</span><br><span class="line"></span><br><span class="line">   //使用自定义函数   </span><br><span class="line">        Dataset&lt;Row&gt; orderDistanceCustomer = orderLocalInfo.withColumn(&quot;order_distance_customer&quot;,</span><br><span class="line">                callUDF(&quot;orderDistanceCustomer&quot;,</span><br><span class="line">                orderLocalInfo.col(&quot;customer_lat&quot;), orderLocalInfo.col(&quot;customer_long&quot;),</span><br><span class="line">                orderLocalInfo.col(&quot;latitude&quot;), orderLocalInfo.col(&quot;longitude&quot;)));</span><br></pre></td></tr></table></figure>
<h3 id="spark提交命令"><a href="#spark提交命令" class="headerlink" title="spark提交命令"></a>spark提交命令</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup spark-submit --class com.gree.bdc.analysis.DispatchDetailsInfo  --master local[2] --executor-memory 8G --total-executor-cores 4  /home/bdcopt/spark/order-details-handle-1.0-SNAPSHOT-jar-with-dependencies.jar  &gt; /tmp/spark/order/order-datails.log &amp;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-02-26T02:31:17.000Z">2020-02-26</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 分钟 读完 (大约 801 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/02/26/shiro/">shiro</a>
            
        </h1>
        <div class="content">
            <h1 id="shiro"><a href="#shiro" class="headerlink" title="shiro"></a>shiro</h1><blockquote>
<p>Apache Shiro 是一个强大易用的 Java 安全框架，提供了认证、授权、加密和会话管理等功能，对于任何一个应用程序，Shiro 都可以提供全面的安全管理服务。</p>
</blockquote>
<p><img src="/images/2020/02/25/3fbc6bf0-5773-11ea-b312-7dd32fa3bd34.png" alt="image.png"></p>
<blockquote>
<p>Authentication：身份认证 / 登录，验证用户是不是拥有相应的身份；</p>
</blockquote>
<p>Authorization：授权，即权限验证，验证某个已认证的用户是否拥有某个权限；即判断用户是否能做事情，常见的如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限；</p>
<p>Session Manager：会话管理，即用户登录后就是一次会话，在没有退出之前，它的所有信息都在会话中；会话可以是普通 JavaSE 环境的，也可以是如 Web 环境的；</p>
<p>Cryptography：加密，保护数据的安全性，如密码加密存储到数据库，而不是明文存储；</p>
<p>Web Support：Web 支持，可以非常容易的集成到 Web 环境；</p>
<p>Caching：缓存，比如用户登录后，其用户信息、拥有的角色 / 权限不必每次去查，这样可以提高效率；</p>
<p>Concurrency：shiro 支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去；</p>
<p>Testing：提供测试支持；</p>
<p>Run As：允许一个用户假装为另一个用户（如果他们允许）的身份进行访问；</p>
<p>Remember Me：记住我，这个是非常常见的功能，即一次登录后，下次再来的话不用登录了。</p>
<p><img src="/images/2020/02/25/6d86ae60-5773-11ea-b312-7dd32fa3bd34.png" alt="image.png"></p>
<blockquote>
<p>Subject：主体，代表了当前 “用户”，这个用户不一定是一个具体的人，与当前应用交互的任何东西都是 Subject，如网络爬虫，机器人等；即一个抽象概念；所有 Subject 都绑定到 SecurityManager，与 Subject 的所有交互都会委托给 SecurityManager；可以把 Subject 认为是一个门面；SecurityManager 才是实际的执行者；</p>
</blockquote>
<p>SecurityManager：安全管理器；即所有与安全有关的操作都会与 SecurityManager 交互；且它管理着所有 Subject；可以看出它是 Shiro 的核心，它负责与后边介绍的其他组件进行交互，如果学习过 SpringMVC，你可以把它看成 DispatcherServlet 前端控制器；</p>
<p>Realm：域，Shiro 从从 Realm 获取安全数据（如用户、角色、权限），就是说 SecurityManager 要验证用户身份，那么它需要从 Realm 获取相应的用户进行比较以确定用户身份是否合法；也需要从 Realm 得到用户相应的角色 / 权限进行验证用户是否能进行操作；可以把 Realm 看成 DataSource，即安全数据源。</p>
<p>参考：<a href="https://www.w3cschool.cn/shiro/" target="_blank" rel="noopener">跟我学shiro</a></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-02-24T01:10:01.000Z">2020-02-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/后台/">后台</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    18 分钟 读完 (大约 2626 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/02/24/权限设计管理/">权限设计管理</a>
            
        </h1>
        <div class="content">
            <h2 id="基于RBAC（Resource-Based-Access-Control）"><a href="#基于RBAC（Resource-Based-Access-Control）" class="headerlink" title="基于RBAC（Resource-Based Access Control）"></a>基于RBAC（Resource-Based Access Control）</h2><h4 id="资源权限控制抽象为uri的访问控制（uri权限控制表）"><a href="#资源权限控制抽象为uri的访问控制（uri权限控制表）" class="headerlink" title="资源权限控制抽象为uri的访问控制（uri权限控制表）"></a>资源权限控制抽象为uri的访问控制（uri权限控制表）</h4><p>自增长id<br>uri(根据业务需要控制颗粒度，例如细可以精确到一条数据的访问，或者，粗可以只是控制一个页面的访问)<br>access_allow</p>
<h4 id="用户角色（user-role）"><a href="#用户角色（user-role）" class="headerlink" title="用户角色（user role）"></a>用户角色（user role）</h4><p>自增长id<br>用户角色描述</p>
<h4 id="用户组（user-group）"><a href="#用户组（user-group）" class="headerlink" title="用户组（user group）"></a>用户组（user group）</h4><p>自增长id<br>用户组描述</p>
<h4 id="用户（user）"><a href="#用户（user）" class="headerlink" title="用户（user）"></a>用户（user）</h4><p>自增长id<br>用户其他相关信息（用户名，password等等）</p>
<h4 id="用户角色（user-role）-uri访问权限集合（角色-uri权限关系表）"><a href="#用户角色（user-role）-uri访问权限集合（角色-uri权限关系表）" class="headerlink" title="用户角色（user role）-uri访问权限集合（角色-uri权限关系表）"></a>用户角色（user role）-uri访问权限集合（角色-uri权限关系表）</h4><p>用户角色id<br>uri权限id</p>
<h4 id="用户组（user-group）-uri访问权限集合（用户组-uri权限关系表）"><a href="#用户组（user-group）-uri访问权限集合（用户组-uri权限关系表）" class="headerlink" title="用户组（user group）-uri访问权限集合（用户组-uri权限关系表）"></a>用户组（user group）-uri访问权限集合（用户组-uri权限关系表）</h4><p>用户组id<br>uri权限id</p>
<h4 id="用户（user-）-uri访问权限集合（用户-uri权限关系表）"><a href="#用户（user-）-uri访问权限集合（用户-uri权限关系表）" class="headerlink" title="用户（user ）-uri访问权限集合（用户-uri权限关系表）"></a>用户（user ）-uri访问权限集合（用户-uri权限关系表）</h4><p>用户id<br>uri权限id</p>
<h4 id="用户组（user-group）-用户角色（user-role）集合（用户组-用户角色关系表）"><a href="#用户组（user-group）-用户角色（user-role）集合（用户组-用户角色关系表）" class="headerlink" title="用户组（user group）- 用户角色（user role）集合（用户组-用户角色关系表）"></a>用户组（user group）- 用户角色（user role）集合（用户组-用户角色关系表）</h4><p>用户角色id<br>用户组id</p>
<h4 id="用户（user）-用户组（user-group）集合（用户-用户组关系表）"><a href="#用户（user）-用户组（user-group）集合（用户-用户组关系表）" class="headerlink" title="用户（user）- 用户组（user group）集合（用户-用户组关系表）"></a>用户（user）- 用户组（user group）集合（用户-用户组关系表）</h4><p>用户id<br>用户组id</p>
<h4 id="用户（user）-用户角色（user-role）集合（用户-用户角色表）"><a href="#用户（user）-用户角色（user-role）集合（用户-用户角色表）" class="headerlink" title="用户（user）- 用户角色（user role）集合（用户-用户角色表）"></a>用户（user）- 用户角色（user role）集合（用户-用户角色表）</h4><p>用户角色id<br>用户id</p>
<p><img src="/images/2020/02/19/44fa5c10-52e8-11ea-8c8e-7b6faf42a2fd.png" alt="image.png"></p>
<p><img src="/images/2020/02/22/68cdca20-5516-11ea-a50a-c34d50658225.png" alt="image.png"></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> Navicat Premium Data Transfer</span><br><span class="line"></span><br><span class="line"> Source Server         : 本地</span><br><span class="line"> Source Server Type    : MySQL</span><br><span class="line"> Source Server Version : 80012</span><br><span class="line"> Source Host           : localhost:3306</span><br><span class="line"> Source Schema         : gps_test</span><br><span class="line"></span><br><span class="line"> Target Server Type    : MySQL</span><br><span class="line"> Target Server Version : 80012</span><br><span class="line"> File Encoding         : 65001</span><br><span class="line"></span><br><span class="line"> Date: 21/02/2020 15:14:54</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">SET NAMES utf8mb4;</span><br><span class="line">SET FOREIGN_KEY_CHECKS = 0;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for permission</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `permission`;</span><br><span class="line">CREATE TABLE `permission`  (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;权限ID&apos;,</span><br><span class="line">  `parent_id` bigint(20) DEFAULT NULL COMMENT &apos;所属父级权限ID&apos;,</span><br><span class="line">  `code` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;权限唯一CODE代码&apos;,</span><br><span class="line">  `name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;权限名称&apos;,</span><br><span class="line">  `dsca` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;权限描述&apos;,</span><br><span class="line">  `category` tinyint(1) DEFAULT NULL COMMENT &apos;权限类别&apos;,</span><br><span class="line">  `uri` bigint(20) DEFAULT NULL COMMENT &apos;URL规则&apos;,</span><br><span class="line">  `create_time` datetime(0) DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class="line">  `creator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;创建人&apos;,</span><br><span class="line">  `update_time` datetime(0) DEFAULT NULL COMMENT &apos;更新时间&apos;,</span><br><span class="line">  `regenerator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;更新者&apos;,</span><br><span class="line">  `del_flag` tinyint(1) UNSIGNED ZEROFILL DEFAULT 0 COMMENT &apos;逻辑删除:0=未删除,1=已删除&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE,</span><br><span class="line">  INDEX `parent_id`(`parent_id`) USING BTREE COMMENT &apos;父级权限ID&apos;,</span><br><span class="line">  INDEX `code`(`code`) USING BTREE COMMENT &apos;权限CODE代码&apos;</span><br><span class="line">) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = &apos;权限&apos; ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for role</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `role`;</span><br><span class="line">CREATE TABLE `role`  (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;角色ID&apos;,</span><br><span class="line">  `code` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;角色唯一CODE代码&apos;,</span><br><span class="line">  `name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;角色名称&apos;,</span><br><span class="line">  `desc` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;角色描述&apos;,</span><br><span class="line">  `create_time` datetime(0) DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class="line">  `creator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;创建人&apos;,</span><br><span class="line">  `update_time` datetime(0) DEFAULT NULL COMMENT &apos;更新时间&apos;,</span><br><span class="line">  `regenerator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;更改者&apos;,</span><br><span class="line">  `del_flag` tinyint(1) UNSIGNED ZEROFILL DEFAULT 0 COMMENT &apos;逻辑删除:0=未删除,1=已删除&apos;,</span><br><span class="line">  `type` tinyint(1) NOT NULL DEFAULT 1 COMMENT &apos;0：超管、1：管理员、2：普通人员&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE,</span><br><span class="line">  INDEX `code`(`code`) USING BTREE COMMENT &apos;权限CODE代码&apos;</span><br><span class="line">) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = &apos;角色&apos; ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for role_permission</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `role_permission`;</span><br><span class="line">CREATE TABLE `role_permission`  (</span><br><span class="line">  `role_id` int(11) NOT NULL COMMENT &apos;角色id&apos;,</span><br><span class="line">  `permission_id` int(11) DEFAULT NULL COMMENT &apos;权限id&apos;</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user`;</span><br><span class="line">CREATE TABLE `user`  (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;用户ID&apos;,</span><br><span class="line">  `state` tinyint(1) DEFAULT NULL COMMENT &apos;用户状态:0=正常,1=禁用&apos;,</span><br><span class="line">  `user_name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;姓名&apos;,</span><br><span class="line">  `user_tel_number` varchar(11) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;手机号码&apos;,</span><br><span class="line">  `salt` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;密码加盐&apos;,</span><br><span class="line">  `password` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;登录密码&apos;,</span><br><span class="line">  `create_time` datetime(0) DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class="line">  `creator` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;创建人&apos;,</span><br><span class="line">  `update_time` datetime(0) DEFAULT NULL COMMENT &apos;更新时间&apos;,</span><br><span class="line">  `regenerator` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;更新者&apos;,</span><br><span class="line">  `del_flag` tinyint(1) UNSIGNED ZEROFILL DEFAULT 0 COMMENT &apos;逻辑删除:0=未删除,1=已删除&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = &apos;用户&apos; ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user_group</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user_group`;</span><br><span class="line">CREATE TABLE `user_group`  (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;ID&apos;,</span><br><span class="line">  `parent_id` bigint(20) DEFAULT NULL COMMENT &apos;所属父级用户组ID&apos;,</span><br><span class="line">  `name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;用户组名称&apos;,</span><br><span class="line">  `code` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;用户组CODE唯一代码&apos;,</span><br><span class="line">  `desc` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;用户组描述&apos;,</span><br><span class="line">  `create_time` datetime(0) DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class="line">  `creator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;创建人&apos;,</span><br><span class="line">  `update_time` datetime(0) DEFAULT NULL COMMENT &apos;更新时间&apos;,</span><br><span class="line">  `regenerator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;更新者&apos;,</span><br><span class="line">  `del_flag` tinyint(1) UNSIGNED ZEROFILL DEFAULT 0 COMMENT &apos;逻辑删除:0=未删除,1=已删除&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE,</span><br><span class="line">  INDEX `parent_id`(`parent_id`) USING BTREE COMMENT &apos;父级用户组ID&apos;,</span><br><span class="line">  INDEX `code`(`code`) USING BTREE COMMENT &apos;用户组CODE代码&apos;</span><br><span class="line">) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = &apos;用户组&apos; ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user_group_role</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user_group_role`;</span><br><span class="line">CREATE TABLE `user_group_role`  (</span><br><span class="line">  `user_group_id` int(11) NOT NULL COMMENT &apos;用户组id&apos;,</span><br><span class="line">  `role_id` int(11) DEFAULT NULL COMMENT &apos;角色id&apos;</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user_role</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user_role`;</span><br><span class="line">CREATE TABLE `user_role`  (</span><br><span class="line">  `user_id` int(11) NOT NULL COMMENT &apos;用户id&apos;,</span><br><span class="line">  `role_id` int(11) DEFAULT NULL COMMENT &apos;角色id&apos;</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user_user_group</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user_user_group`;</span><br><span class="line">CREATE TABLE `user_user_group`  (</span><br><span class="line">  `user_id` int(11) NOT NULL COMMENT &apos;用户id&apos;,</span><br><span class="line">  `user_group_id` int(11) DEFAULT NULL COMMENT &apos;用户组id&apos;</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">SET FOREIGN_KEY_CHECKS = 1;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第二版：权限设计表结构（主要新增了user_permission表 和 user_group_permission表 用于灵活的控制权限修改和授权操作，user_group 用户组表 parent_id属性的删除，主要区别于组织架构的系统，能够更加通用化设计）</p>
</blockquote>
<p><img src="/images/2020/02/24/e109f130-56a1-11ea-a50a-c34d50658225.png" alt="image.png"></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> Navicat Premium Data Transfer</span><br><span class="line"></span><br><span class="line"> Source Server         : 本地</span><br><span class="line"> Source Server Type    : MySQL</span><br><span class="line"> Source Server Version : 80012</span><br><span class="line"> Source Host           : localhost:3306</span><br><span class="line"> Source Schema         : gps_test</span><br><span class="line"></span><br><span class="line"> Target Server Type    : MySQL</span><br><span class="line"> Target Server Version : 80012</span><br><span class="line"> File Encoding         : 65001</span><br><span class="line"></span><br><span class="line"> Date: 24/02/2020 08:51:04</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">SET NAMES utf8mb4;</span><br><span class="line">SET FOREIGN_KEY_CHECKS = 0;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for permission</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `permission`;</span><br><span class="line">CREATE TABLE `permission`  (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;权限ID&apos;,</span><br><span class="line">  `parent_id` bigint(20) DEFAULT NULL COMMENT &apos;所属父级权限ID&apos;,</span><br><span class="line">  `code` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;权限唯一CODE代码&apos;,</span><br><span class="line">  `name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;权限名称&apos;,</span><br><span class="line">  `dsca` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;权限描述&apos;,</span><br><span class="line">  `category` tinyint(1) DEFAULT NULL COMMENT &apos;权限类别&apos;,</span><br><span class="line">  `uri` bigint(20) DEFAULT NULL COMMENT &apos;URL规则&apos;,</span><br><span class="line">  `create_time` datetime(0) DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class="line">  `creator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;创建人&apos;,</span><br><span class="line">  `update_time` datetime(0) DEFAULT NULL COMMENT &apos;更新时间&apos;,</span><br><span class="line">  `regenerator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;更新者&apos;,</span><br><span class="line">  `del_flag` tinyint(1) UNSIGNED ZEROFILL DEFAULT 0 COMMENT &apos;逻辑删除:0=未删除,1=已删除&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE,</span><br><span class="line">  INDEX `parent_id`(`parent_id`) USING BTREE COMMENT &apos;父级权限ID&apos;,</span><br><span class="line">  INDEX `code`(`code`) USING BTREE COMMENT &apos;权限CODE代码&apos;</span><br><span class="line">) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = &apos;权限&apos; ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for role</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `role`;</span><br><span class="line">CREATE TABLE `role`  (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;角色ID&apos;,</span><br><span class="line">  `code` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;角色唯一CODE代码&apos;,</span><br><span class="line">  `name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;角色名称&apos;,</span><br><span class="line">  `desc` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;角色描述&apos;,</span><br><span class="line">  `create_time` datetime(0) DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class="line">  `creator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;创建人&apos;,</span><br><span class="line">  `update_time` datetime(0) DEFAULT NULL COMMENT &apos;更新时间&apos;,</span><br><span class="line">  `regenerator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;更改者&apos;,</span><br><span class="line">  `del_flag` tinyint(1) UNSIGNED ZEROFILL DEFAULT 0 COMMENT &apos;逻辑删除:0=未删除,1=已删除&apos;,</span><br><span class="line">  `type` tinyint(1) NOT NULL DEFAULT 1 COMMENT &apos;0：超管、1：管理员、2：普通人员&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE,</span><br><span class="line">  INDEX `code`(`code`) USING BTREE COMMENT &apos;权限CODE代码&apos;</span><br><span class="line">) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = &apos;角色&apos; ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for role_permission</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `role_permission`;</span><br><span class="line">CREATE TABLE `role_permission`  (</span><br><span class="line">  `role_id` int(11) NOT NULL COMMENT &apos;角色id&apos;,</span><br><span class="line">  `permission_id` int(11) DEFAULT NULL COMMENT &apos;权限id&apos;</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user`;</span><br><span class="line">CREATE TABLE `user`  (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;用户ID&apos;,</span><br><span class="line">  `state` tinyint(1) DEFAULT NULL COMMENT &apos;用户状态:0=正常,1=禁用&apos;,</span><br><span class="line">  `user_name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;姓名&apos;,</span><br><span class="line">  `user_tel_number` varchar(11) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;手机号码&apos;,</span><br><span class="line">  `salt` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;密码加盐&apos;,</span><br><span class="line">  `password` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;登录密码&apos;,</span><br><span class="line">  `create_time` datetime(0) DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class="line">  `creator` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;创建人&apos;,</span><br><span class="line">  `update_time` datetime(0) DEFAULT NULL COMMENT &apos;更新时间&apos;,</span><br><span class="line">  `regenerator` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;更新者&apos;,</span><br><span class="line">  `del_flag` tinyint(1) UNSIGNED ZEROFILL DEFAULT 0 COMMENT &apos;逻辑删除:0=未删除,1=已删除&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = &apos;用户&apos; ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user_group</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user_group`;</span><br><span class="line">CREATE TABLE `user_group`  (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;ID&apos;,</span><br><span class="line">  `name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;用户组名称&apos;,</span><br><span class="line">  `code` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;用户组CODE唯一代码&apos;,</span><br><span class="line">  `desc` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;用户组描述&apos;,</span><br><span class="line">  `create_time` datetime(0) DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class="line">  `creator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;创建人&apos;,</span><br><span class="line">  `update_time` datetime(0) DEFAULT NULL COMMENT &apos;更新时间&apos;,</span><br><span class="line">  `regenerator` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &apos;更新者&apos;,</span><br><span class="line">  `del_flag` tinyint(1) UNSIGNED ZEROFILL DEFAULT 0 COMMENT &apos;逻辑删除:0=未删除,1=已删除&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE,</span><br><span class="line">  INDEX `code`(`code`) USING BTREE COMMENT &apos;用户组CODE代码&apos;</span><br><span class="line">) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = &apos;用户组&apos; ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user_group_permission</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user_group_permission`;</span><br><span class="line">CREATE TABLE `user_group_permission`  (</span><br><span class="line">  `user_group_id` int(11) NOT NULL COMMENT &apos;用户组id&apos;,</span><br><span class="line">  `permission_id` int(11) DEFAULT NULL COMMENT &apos;权限id&apos;</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user_group_role</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user_group_role`;</span><br><span class="line">CREATE TABLE `user_group_role`  (</span><br><span class="line">  `user_group_id` int(11) NOT NULL COMMENT &apos;用户组id&apos;,</span><br><span class="line">  `role_id` int(11) DEFAULT NULL COMMENT &apos;角色id&apos;</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user_permission</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user_permission`;</span><br><span class="line">CREATE TABLE `user_permission`  (</span><br><span class="line">  `user_id` int(11) NOT NULL COMMENT &apos;用户id&apos;,</span><br><span class="line">  `permission_id` int(11) DEFAULT NULL COMMENT &apos;权限id&apos;</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user_role</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user_role`;</span><br><span class="line">CREATE TABLE `user_role`  (</span><br><span class="line">  `user_id` int(11) NOT NULL COMMENT &apos;用户id&apos;,</span><br><span class="line">  `role_id` int(11) DEFAULT NULL COMMENT &apos;角色id&apos;</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user_user_group</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `user_user_group`;</span><br><span class="line">CREATE TABLE `user_user_group`  (</span><br><span class="line">  `user_id` int(11) NOT NULL COMMENT &apos;用户id&apos;,</span><br><span class="line">  `user_group_id` int(11) DEFAULT NULL COMMENT &apos;用户组id&apos;</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">SET FOREIGN_KEY_CHECKS = 1;</span><br></pre></td></tr></table></figure>
<p><a href="https://www.processon.com/view/link/5e4c8ffce4b00aefb7e77730%20" target="_blank" rel="noopener">设计表逻辑图</a></p>
<p><img src="/images/2020/02/26/46e26010-5845-11ea-9939-157051740e67.png" alt="image.png"></p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/0/">上一页</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/7/">7</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-4-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/head.png" alt="上善若水">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        上善若水
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        好记性不如烂笔头
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>广州，珠海</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            83
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            8
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            39
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/sfzsjx" target="_blank">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/sfzsjx">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Facebook" href="https://github.com/sfzsjx">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Twitter" href="https://github.com/sfzsjx">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Dribbble" href="https://github.com/sfzsjx">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/sfzsjx" target="_blank">
                    <span class="level-left">
                        <span class="level-item">PPOffice</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/IDEA/">
            <span class="level-start">
                <span class="level-item">IDEA</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/后台/">
            <span class="level-start">
                <span class="level-item">后台</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/大数据/">
            <span class="level-start">
                <span class="level-item">大数据</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">43</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/学习/">
            <span class="level-start">
                <span class="level-item">学习</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数据库/">
            <span class="level-start">
                <span class="level-item">数据库 </span>
            </span>
            <span class="level-end">
                <span class="level-item tag">9</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/程序语言/">
            <span class="level-start">
                <span class="level-item">程序语言</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">10</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/脚本/">
            <span class="level-start">
                <span class="level-item">脚本</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/蓝牙定位/">
            <span class="level-start">
                <span class="level-item">蓝牙定位</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Dataframe/" style="font-size: 10px;">Dataframe</a> <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/Java/" style="font-size: 14.29px;">Java</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/NIFI/" style="font-size: 12.86px;">NIFI</a> <a href="/tags/Scala/" style="font-size: 10px;">Scala</a> <a href="/tags/cdh/" style="font-size: 10px;">cdh</a> <a href="/tags/docker/" style="font-size: 11.43px;">docker</a> <a href="/tags/flink/" style="font-size: 20px;">flink</a> <a href="/tags/hbase/" style="font-size: 11.43px;">hbase</a> <a href="/tags/hive/" style="font-size: 10px;">hive</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/kafka/" style="font-size: 12.86px;">kafka</a> <a href="/tags/kylin/" style="font-size: 10px;">kylin</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/mysql/" style="font-size: 15.71px;">mysql</a> <a href="/tags/neo4j/" style="font-size: 12.86px;">neo4j</a> <a href="/tags/netty/" style="font-size: 10px;">netty</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/scala/" style="font-size: 10px;">scala</a> <a href="/tags/shell/" style="font-size: 11.43px;">shell</a> <a href="/tags/spark/" style="font-size: 18.57px;">spark</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/spring-cloud/" style="font-size: 10px;">spring cloud</a> <a href="/tags/springboot/" style="font-size: 11.43px;">springboot</a> <a href="/tags/决策树/" style="font-size: 11.43px;">决策树</a> <a href="/tags/学习/" style="font-size: 11.43px;">学习</a> <a href="/tags/工具类/" style="font-size: 10px;">工具类</a> <a href="/tags/总结/" style="font-size: 10px;">总结</a> <a href="/tags/数据分析/" style="font-size: 17.14px;">数据分析</a> <a href="/tags/数据库/" style="font-size: 10px;">数据库</a> <a href="/tags/朴素贝叶斯/" style="font-size: 10px;">朴素贝叶斯</a> <a href="/tags/权限设计/" style="font-size: 10px;">权限设计</a> <a href="/tags/校验/" style="font-size: 10px;">校验</a> <a href="/tags/正则匹配/" style="font-size: 10px;">正则匹配</a> <a href="/tags/蓝牙定位/" style="font-size: 11.43px;">蓝牙定位</a>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2020/05/29/flink-算子记录/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="flink 算子记录">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T05:37:12.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/flink-算子记录/" class="title has-link-black-ter is-size-6 has-text-weight-normal">flink 算子记录</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/大数据/">大数据</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/mysql-常见问题/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="mysql 常见问题">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T05:33:17.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/mysql-常见问题/" class="title has-link-black-ter is-size-6 has-text-weight-normal">mysql 常见问题</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/数据库/">数据库 </a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/27/flink-常见问题/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="flink 常见问题">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-27T08:15:57.000Z">2020-05-27</time></div>
                    <a href="/2020/05/27/flink-常见问题/" class="title has-link-black-ter is-size-6 has-text-weight-normal">flink 常见问题</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/大数据/">大数据</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/11/常用工具类/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="常用工具类">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-11T07:27:49.000Z">2020-05-11</time></div>
                    <a href="/2020/05/11/常用工具类/" class="title has-link-black-ter is-size-6 has-text-weight-normal">常用工具类</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/大数据/">大数据</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/07/大数据处理地理数据/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="大数据处理地理数据">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-07T11:55:22.000Z">2020-05-07</time></div>
                    <a href="/2020/05/07/大数据处理地理数据/" class="title has-link-black-ter is-size-6 has-text-weight-normal">大数据处理地理数据</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">10</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">九月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">五月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Dataframe/">
                        <span class="tag">Dataframe</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IDEA/">
                        <span class="tag">IDEA</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/NIFI/">
                        <span class="tag">NIFI</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Scala/">
                        <span class="tag">Scala</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/cdh/">
                        <span class="tag">cdh</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/flink/">
                        <span class="tag">flink</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hbase/">
                        <span class="tag">hbase</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hive/">
                        <span class="tag">hive</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/java/">
                        <span class="tag">java</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/kafka/">
                        <span class="tag">kafka</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/kylin/">
                        <span class="tag">kylin</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux/">
                        <span class="tag">linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mybatis/">
                        <span class="tag">mybatis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mysql/">
                        <span class="tag">mysql</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/neo4j/">
                        <span class="tag">neo4j</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/netty/">
                        <span class="tag">netty</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postman/">
                        <span class="tag">postman</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/python/">
                        <span class="tag">python</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/scala/">
                        <span class="tag">scala</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/shell/">
                        <span class="tag">shell</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spark/">
                        <span class="tag">spark</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring-cloud/">
                        <span class="tag">spring cloud</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/springboot/">
                        <span class="tag">springboot</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/决策树/">
                        <span class="tag">决策树</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/学习/">
                        <span class="tag">学习</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工具类/">
                        <span class="tag">工具类</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/总结/">
                        <span class="tag">总结</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据分析/">
                        <span class="tag">数据分析</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据库/">
                        <span class="tag">数据库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/朴素贝叶斯/">
                        <span class="tag">朴素贝叶斯</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/权限设计/">
                        <span class="tag">权限设计</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/校验/">
                        <span class="tag">校验</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/正则匹配/">
                        <span class="tag">正则匹配</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/蓝牙定位/">
                        <span class="tag">蓝牙定位</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="上善若水博客" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 上善若水&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
<script src="/js/animation.js"></script>

    
    
<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>

    
    
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>

    
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>
    
    
<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>

    
    
    
    
    
    
    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
	<!-- 雪花特效 -->
    <script type="text/javascript">
      var windowWidth = $(window).width();
      if (windowWidth > 480) {
        document.write('<script type="text/javascript" src="/js/src/snow.js"><\/script>');
      }
    </script>
</body>
</html>